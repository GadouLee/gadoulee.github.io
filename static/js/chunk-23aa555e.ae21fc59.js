(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-23aa555e"],{"0993":function(e,t,i){e.exports=i.p+"static/img/checked.f8521b5f.png"},"0ffb":function(e,t,i){},1959:function(e,t,i){"use strict";i("0ffb")},2068:function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.permit_loading||e.initLoading,expression:"permit_loading || initLoading"}],staticStyle:{position:"relative",overflow:"hidden"}},[e.showSubmitBtn?e._e():a("div",{staticStyle:{position:"absolute",top:"5px",right:"300px","z-index":"10"}},["已审批"==e.state_name?a("img",{staticStyle:{display:"block",width:"150px"},attrs:{src:i("0993"),alt:""}}):e._e(),"审批中"==e.state_name?a("img",{staticStyle:{display:"block",width:"150px"},attrs:{src:i("9a04"),alt:""}}):e._e(),"已驳回"==e.state_name?a("img",{staticStyle:{display:"block",width:"150px"},attrs:{src:i("ac6f"),alt:""}}):e._e()]),e.permit_type_name?a("div",{staticStyle:{"margin-top":"50px"}},[a("span",{staticStyle:{"padding-left":"20px",color:"#666666"}},[e._v("审批事项："+e._s(e.permit_type_name))]),e.showIsTop?a("el-button",{staticStyle:{"margin-left":"20px"},attrs:{size:"small",type:"primary"},on:{click:e.handleTop}},[e._v(e._s(e.istop?"取消置顶":"置顶主页"))]):e._e()],1):e._e(),a("div",{staticStyle:{display:"flex","padding-top":"30px"}},[a("div",{staticStyle:{flex:"1",display:"flex","align-items":"center",padding:"20px","max-width":"550px"}},[a("div",{staticStyle:{"font-size":"16px"}},[e._v("选择发票类型：")]),a("el-select",{staticStyle:{width:"150px"},attrs:{disabled:(e.detailToCreate||e.formDisabled)&&e.from!==e.COMPONENT_OPEN_INFO.FROM_TREE_TO_INVOICE,placeholder:"请选择",size:"Default"},model:{value:e.invoicesType,callback:function(t){e.invoicesType=t},expression:"invoicesType"}},[a("el-option",{attrs:{label:"普通发票",value:"1"}}),a("el-option",{attrs:{label:"专用发票",value:"2"}})],1)],1),e.isAdmin?a("div",{staticStyle:{flex:"1",display:"flex","align-items":"center",padding:"20px"}},[a("div",{staticStyle:{"font-size":"16px"}},[e._v("是否归属项目：")]),a("el-select",{staticStyle:{width:"150px"},attrs:{disabled:e.detailToCreate||e.formDisabled,placeholder:"请选择",size:"Default"},on:{change:e.handleIsProjectChange},model:{value:e.reqParam.is_project,callback:function(t){e.$set(e.reqParam,"is_project",t)},expression:"reqParam.is_project"}},[a("el-option",{attrs:{label:"归属",value:1}}),a("el-option",{attrs:{label:"不归属",value:0}})],1)],1):e._e(),e.isAdmin?a("div",{staticStyle:{flex:"1",display:"flex","justify-content":"center","align-items":"center",padding:"20px"}},[a("div",{staticStyle:{"font-size":"16px"}},[e._v("选择项目：")]),a("el-select",{style:{width:(e.detailToCreate||e.formDisabled,"300px")},attrs:{disabled:e.detailToCreate||e.formDisabled,placeholder:"请选择",size:"Default",filterable:"",clearable:""},on:{change:function(t){return e.handleSelectChange(t,"project")}},model:{value:e.reqParam.project_id,callback:function(t){e.$set(e.reqParam,"project_id",t)},expression:"reqParam.project_id"}},e._l(e.projectList,(function(e,t){return a("el-option",{key:t,attrs:{label:e.project_name,value:e.id}})})),1)],1):e._e(),a("div",{staticStyle:{flex:"1",display:"flex","justify-content":"flex-end","align-items":"center",padding:"20px"}},[a("div",{staticStyle:{"font-size":"16px"}},[e._v("选择合同：")]),a("el-select",{style:{width:(e.detailToCreate||e.formDisabled,"300px")},attrs:{disabled:e.detailToCreate||e.formDisabled,placeholder:"请选择",size:"Default",filterable:"",clearable:""},on:{change:function(t){return e.handleSelectChange(t,"contract")}},model:{value:e.reqParam.contract_id,callback:function(t){e.$set(e.reqParam,"contract_id",t)},expression:"reqParam.contract_id"}},e._l(e.contractList,(function(e){return a("el-option",{key:e.id,attrs:{label:e.contract_name,value:e.id}})})),1)],1)]),e.showOcr?a("div",{staticClass:"w-full flex flex-row justify-end items-center px-normal"},[a("ocr-invoice",{on:{success:e.getOcrInfo}})],1):e._e(),a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"invoices",staticStyle:{padding:"80px 20px"}},[a("div",{staticStyle:{"font-size":"25px","text-align":"center"}},[e._v("电子发票( "+e._s(1==e.invoicesType?"普通":"专用")+" )发票")]),e._m(0),a("div",{staticStyle:{display:"flex","font-size":"12px"}},[a("div",{staticStyle:{flex:"1",display:"flex","align-items":"center"}},[a("div",{staticStyle:{width:"30px","flex-shrink":"0",border:"1px solid #eee","text-align":"center",padding:"5px","border-bottom":"none"}},[e._v(" 购买方信息")]),a("div",{staticStyle:{height:"100%",width:"100%",display:"flex","flex-direction":"column"}},[a("div",{staticStyle:{flex:"1",border:"1px solid #eee","border-left":"none","border-right":"none",display:"flex","align-items":"center","padding-left":"5px"}},[e._v(" 名称: "),a("el-select",{staticClass:"text-important",staticStyle:{width:"calc(100% - 30px)"},attrs:{disabled:e.detailToCreate,placeholder:"请选择",size:"Default",filterable:"",clearable:""},model:{value:e.reqParam.payment_company_id,callback:function(t){e.$set(e.reqParam,"payment_company_id",t)},expression:"reqParam.payment_company_id"}},e._l(e.companyList,(function(e,t){return a("el-option",{key:t,attrs:{label:e.name,value:e.id}})})),1)],1),a("div",{staticStyle:{flex:"1","border-right":"none",display:"flex","align-items":"center","padding-left":"5px"}},[e._v(" 统一社会信用代码/纳税人识别号: "),a("span",{staticStyle:{"padding-left":"5px",color:"#666"}},[e._v(e._s(e.payInvoice_code))])])])]),a("div",{staticStyle:{flex:"1",display:"flex","align-items":"center","font-size":"12px"}},[a("div",{staticStyle:{width:"30px","flex-shrink":"0",border:"1px solid #eee","text-align":"center",padding:"5px","border-bottom":"none"}},[e._v(" 销售方信息")]),a("div",{staticStyle:{height:"100%",width:"100%",display:"flex","flex-direction":"column"}},[a("div",{staticStyle:{flex:"1",border:"1px solid #eee","border-left":"none",display:"flex","align-items":"center","padding-left":"5px"}},[e._v(" 名称: "),a("el-select",{staticClass:"text-important",staticStyle:{width:"calc(100% - 30px)"},attrs:{disabled:e.detailToCreate,placeholder:"请选择",size:"Default",filterable:"",clearable:""},model:{value:e.reqParam.revenue_company_id,callback:function(t){e.$set(e.reqParam,"revenue_company_id",t)},expression:"reqParam.revenue_company_id"}},e._l(e.companyList,(function(e,t){return a("el-option",{key:t,attrs:{label:e.name,value:e.id}})})),1)],1),a("div",{staticStyle:{flex:"1","border-right":"1px solid #eee",display:"flex","align-items":"center","padding-left":"5px"}},[e._v(" 统一社会信用代码/纳税人识别号:"),a("span",{staticStyle:{"padding-left":"5px",color:"#666"}},[e._v(e._s(e.revenue_Invoice_code))])])])])]),a("div",[a("div",{staticStyle:{display:"flex","font-size":"12px"}},[a("div",{staticStyle:{height:"30px","line-height":"30px","text-align":"center",flex:"1","border-left":"1px solid #eee","border-bottom":"1px solid #eee","border-right":"1px solid #eee","border-top":"1px solid #eee"}},[e._v(" 项目名称(必填) "),a("el-button",{attrs:{type:"text"},on:{click:e.handleAddItem}},[e._v("添加")])],1),a("div",{staticStyle:{height:"30px","line-height":"30px","text-align":"center",flex:"1","border-bottom":"1px solid #eee","border-right":"1px solid #eee","border-top":"1px solid #eee"}},[e._v(" 规格型号(选填)")]),a("div",{staticStyle:{height:"30px","line-height":"30px","text-align":"center",flex:"1","border-bottom":"1px solid #eee","border-right":"1px solid #eee","border-top":"1px solid #eee"}},[e._v(" 单位(必填)")]),a("div",{staticStyle:{height:"30px","line-height":"30px","text-align":"center",flex:"1","border-bottom":"1px solid #eee","border-right":"1px solid #eee","border-top":"1px solid #eee"}},[e._v(" 数量(必填)")]),a("div",{staticStyle:{height:"30px","line-height":"30px","text-align":"center",flex:"1","border-bottom":"1px solid #eee","border-right":"1px solid #eee","border-top":"1px solid #eee"}},[e._v(" 单价(含税)(必埴)")]),a("div",{staticStyle:{height:"30px","line-height":"30px","text-align":"center",flex:"1","border-bottom":"1px solid #eee","border-right":"1px solid #eee","border-top":"1px solid #eee"}},[e._v(" 金额(含税)(必埴)")]),a("div",{staticStyle:{height:"30px","line-height":"30px","text-align":"center",flex:"1","border-bottom":"1px solid #eee","border-right":"1px solid #eee","border-top":"1px solid #eee"}},[e._v(" 税率/征收率(必埴)")]),a("div",{staticStyle:{height:"30px","line-height":"30px","text-align":"center",flex:"1","border-bottom":"1px solid #eee","border-top":"1px solid #eee","border-right":"1px solid #eee"}},[e._v(" 税额(必埴)")])]),e._l(e.reqParam.info_data,(function(t,i){return a("div",{key:i,staticStyle:{display:"flex","font-size":"12px","box-sizing":"border-box"}},[a("div",{staticStyle:{height:"30px",flex:"1","border-left":"1px solid #eee","border-bottom":"1px solid #eee","border-right":"1px solid #eee"}},[a("el-input",{staticClass:"cumInput text-important-input",style:{height:"30px"},attrs:{title:t.project_name},on:{input:e.handleInput},model:{value:t.project_name,callback:function(i){e.$set(t,"project_name",i)},expression:"item.project_name"}})],1),a("div",{staticStyle:{height:"30px",flex:"1","border-bottom":"1px solid #eee","border-right":"1px solid #eee"}},[a("el-input",{staticClass:"cumInput text-important-input",attrs:{title:t.specifications},on:{input:e.handleInput},model:{value:t.specifications,callback:function(i){e.$set(t,"specifications",i)},expression:"item.specifications"}})],1),a("div",{staticStyle:{height:"30px",flex:"1","border-bottom":"1px solid #eee","border-right":"1px solid #eee"}},[a("el-input",{staticClass:"cumInput text-important-input",attrs:{title:t.unit},on:{input:e.handleInput},model:{value:t.unit,callback:function(i){e.$set(t,"unit",i)},expression:"item.unit"}})],1),a("div",{staticStyle:{height:"30px",flex:"1","border-bottom":"1px solid #eee","border-right":"1px solid #eee"}},[a("el-input",{staticClass:"cumInput text-important-input",attrs:{title:t.quantity},on:{input:function(t){return e.handleInput(t,i,"quantity")}},model:{value:t.quantity,callback:function(i){e.$set(t,"quantity",i)},expression:"item.quantity"}})],1),a("div",{staticStyle:{height:"30px",flex:"1","border-bottom":"1px solid #eee","border-right":"1px solid #eee"}},[a("el-input",{staticClass:"cumInput text-important-input",attrs:{title:t.unit_price},on:{input:function(t){return e.handleInput(t,i,"unit_price")}},model:{value:t.unit_price,callback:function(i){e.$set(t,"unit_price",i)},expression:"item.unit_price"}})],1),a("div",{staticStyle:{height:"30px",flex:"1","border-bottom":"1px solid #eee","border-right":"1px solid #eee"}},[a("el-input",{staticClass:"cumInput text-important-input",attrs:{title:t.total_amount},on:{input:function(t){return e.handleInput(t,i,"total_amount")}},model:{value:t.total_amount,callback:function(i){e.$set(t,"total_amount",i)},expression:"item.total_amount"}})],1),a("div",{staticStyle:{height:"30px",flex:"1","border-bottom":"1px solid #eee","border-right":"1px solid #eee"}},[a("el-input",{staticClass:"cumInput text-important-input",attrs:{title:t.tariff},on:{input:function(t){return e.handleInput(t,i,"tariff")}},model:{value:t.tariff,callback:function(i){e.$set(t,"tariff",i)},expression:"item.tariff"}})],1),a("div",{staticStyle:{height:"30px",flex:"1","border-bottom":"1px solid #eee","border-right":"1px solid #eee"}},[a("el-input",{staticClass:"cumInput",attrs:{title:t.tax},on:{input:function(t){return e.handleInput(t,i,"tax")}},model:{value:t.tax,callback:function(i){e.$set(t,"tax",i)},expression:"item.tax"}})],1)])})),a("div",{staticStyle:{display:"flex","font-size":"12px","box-sizing":"border-box"}},[a("div",{staticStyle:{height:"30px","line-height":"30px","text-align":"center",flex:"1","border-left":"1px solid #eee","border-bottom":"1px solid #eee","border-right":"1px solid #eee"}},[e._v(" 合计")]),a("div",{staticStyle:{height:"30px","line-height":"30px","text-align":"left",flex:"4","border-bottom":"1px solid #eee","border-right":"1px solid #eee"}},[a("span",{staticStyle:{"padding-left":"5px","font-size":"16px","font-weight":"bold"}},[e._v(e._s(e.all_price_upCase))])]),a("div",{staticStyle:{height:"30px","line-height":"30px","text-align":"center",flex:"1","border-bottom":"1px solid #eee","border-right":"1px solid #eee"}},[e._v(" (小写)￥")]),a("div",{staticStyle:{height:"30px","line-height":"30px","text-align":"left",flex:"2","border-bottom":"1px solid #eee","border-right":"1px solid #eee"}},[a("span",{staticStyle:{"padding-left":"5px","font-size":"16px","font-weight":"bold"}},[e._v(e._s(e.reqParam.money))])])]),a("div",{staticStyle:{display:"flex","font-size":"12px"}},[a("div",{staticStyle:{width:"20px","flex-shrink":"0",height:"50px","line-height":"25px","text-align":"center","border-left":"1px solid #eee","border-bottom":"1px solid #eee","border-right":"1px solid #eee"}},[e._v(" 备注")]),a("div",{staticStyle:{height:"50px","line-height":"50px","text-align":"center",flex:"1","border-bottom":"1px solid #eee","border-right":"1px solid #eee"}},[a("el-input",{staticClass:"cumInput text-important-input",attrs:{title:e.reqParam.remarks},model:{value:e.reqParam.remarks,callback:function(t){e.$set(e.reqParam,"remarks",t)},expression:"reqParam.remarks"}})],1)]),a("div",{staticStyle:{display:"flex"}},[a("div",{staticStyle:{height:"50px","line-height":"50px","text-align":"center",flex:"1","border-left":"1px solid #eee","border-bottom":"1px solid #eee","border-right":"1px solid #eee"}},["draft_edit"===e.withModal.type?a("div",{staticClass:"flex flex-row justify-center"},[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.editContractDraft}},[e._v("保存修改")]),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.handleInvoicesAdd(!0)}}},[e._v("转为创建")])],1):e._e(),"create"===e.withModal.type?a("el-button",{attrs:{size:"mini"},on:{click:e.createDraft}},[e._v("保存为草稿")]):e._e(),e.showSubmitBtn?a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.handleInvoicesAdd}},[e._v("提交")]):e._e(),e.canyuShow?a("div",[e.showSubmitBtn||0!=e.stateFlag?e._e():a("div",{staticClass:"action",staticStyle:{"text-align":"center"}},[a("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.handlePass()}}},[e._v("通过")]),a("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(t){return e.handleReject()}}},[e._v("驳回")]),e.permit_response&&void 0!==e.permit_response.project_id?a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.toProjectDetail}},[e._v("Go项目脑图审批")]):e._e()],1)]):e._e()],1)])],2)])])},n=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticStyle:{display:"flex","justify-content":"center"}},[i("div",{staticStyle:{"font-size":"14px",display:"flex",margin:"20px"}},[i("div",[e._v("发票号码:以最终开出发票为准")]),i("div",{staticStyle:{"margin-left":"20px"}},[e._v("开票日期:以最终开出发票为准")])])])}],r=i("5530"),o=i("c7eb"),c=i("1da1"),s=(i("99af"),i("7db0"),i("caad"),i("d81d"),i("b0c0"),i("e9c4"),i("a9e3"),i("b680"),i("b64b"),i("d3b7"),i("0643"),i("fffc"),i("a573"),i("277f")),l=i("429f"),d=i("9beb"),p=i("267e"),u=i("ed08"),m=i("38d4"),f=i("9853"),_={components:{ocrInvoice:f["a"]},props:{withModal:{type:Object,default:void 0}},data:function(){return{loading:!1,showOcr:!1,COMPONENT_OPEN_INFO:p["a"],state_name:"",permit_type_name:"",istop:!1,showIsTop:!1,formDisabled:!1,isAdd:!0,canyuShow:!0,isAdmin:!0,showSubmitBtn:!0,invoicesType:"2",all_price_upCase:"",companyList:[],projectList:[],contractList:[],payInvoice_code:"",revenue_Invoice_code:"",reqParam:{is_project:0,project_id:"",contract_id:"",type:"",payment_company_id:"",money:"",revenue_company_id:"",remarks:"",info_data:[{project_name:"",specifications:"",unit:"",quantity:"",unit_price:"",total_amount:"",tariff:"",tax:""},{project_name:"",specifications:"",unit:"",quantity:"",unit_price:"",total_amount:"",tariff:"",tax:""},{project_name:"",specifications:"",unit:"",quantity:"",unit_price:"",total_amount:"",tariff:"",tax:""}]},detailToCreate:!1,from:"",permit_response:void 0,permit_loading:!1,initLoading:!1}},watch:{reqParam:{handler:function(e,t){var i=this;this.companyList&&this.companyList.map((function(t,a){t.id===e.payment_company_id&&(i.payInvoice_code=t.invoice_code),t.id===e.revenue_company_id&&(i.revenue_Invoice_code=t.invoice_code)}));var a=0;e.info_data.map((function(e){a=Number(a)+Number(e.total_amount)})),this.publicsNumToUpper(a),this.reqParam.money=a.toFixed(2)},deep:!0,immediate:!0},"reqParam.project_id":{handler:function(e,t){e!==t&&(this.reqParam.contract_id="")},deep:!0}},mounted:function(){var e=this;return Object(c["a"])(Object(o["a"])().mark((function t(){var i,a,n,r,c,l,d,p;return Object(o["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.withModal){t.next=27;break}return e.initLoading=!0,e.state_name=null===(i=e.withModal.permit_row)||void 0===i?void 0:i.state_name,e.permit_type_name=null===(a=e.withModal.permit_row)||void 0===a?void 0:a.permit_type_name,e.istop=null===(n=e.withModal.permit_row)||void 0===n?void 0:n.istop,e.showIsTop=(null===(r=e.withModal.permit_row)||void 0===r?void 0:r.state)>=0,t.next=8,e.getCompanyList();case 8:if(e.withModal.hide_permit_btn&&(e.canyuShow=!1),"create"===e.withModal.type&&(e.showOcr=!0),!e.withModal.data){t.next=25;break}if(c=e.withModal.data,Object(s["l"])({project_id:e.withModal.data.project_id}).then((function(t){e.contractList=t.data,e.reqParam.contract_id=e.withModal.data.contract_id})),"普票"===c.type?e.invoicesType="1":e.invoicesType="2","draft_edit"===e.withModal.type&&(e.showSubmitBtn=!1),!["edit","audit"].includes(e.withModal.type)){t.next=23;break}if("audit"!==e.withModal.type){t.next=20;break}return e.formDisabled=!0,t.next=20,e.getPermitInfos();case 20:e.stateId=e.withModal.id,e.stateFlag=e.withModal.data.state,e.showSubmitBtn=!1;case 23:e.$store.state.company.companyList.map((function(t,i){t.id===c.payment_company_id&&(e.payInvoice_code=t.invoice_code),t.id===c.revenue_company_id&&(e.revenue_Invoice_code=t.invoice_code)})),e.reqParam=c;case 25:return e.initLoading=!1,t.abrupt("return");case 27:e.state_name=e.$route.query.state_name,e.permit_type_name=e.$route.query.permit_type_name,e.istop="1"===e.$route.query.isTop,e.showIsTop="0"===e.$route.query.state,e.getCompanyList(),e.$route.query.canyuShow||void 0===e.$route.query.canyuShow||(e.canyuShow=e.$route.query.canyuShow),e.$route.query.data&&(l=JSON.parse(e.$route.query.data),Object(s["l"])({project_id:JSON.parse(e.$route.query.data).project_id}).then((function(t){e.contractList=t.data,e.reqParam.contract_id=e.$route.query.detailToCreate?JSON.parse(e.$route.query.data).id:JSON.parse(e.$route.query.data).contract_id})),"普票"===l.type?e.invoicesType="1":e.invoicesType="2",d=JSON.parse(e.$route.query.data),e.$route.query.type?("3"===e.$route.query.type&&(e.formDisabled=!0,e.getPermitInfos()),e.stateId=e.$route.query.id||(null===(p=e.withModal)||void 0===p?void 0:p.id),e.stateFlag=e.$route.query.state,e.showSubmitBtn=!1):(e.showOcr=!0,d.contract_id=d.id,d.payment_company_id=d.contract_party_a_company_id,d.revenue_company_id=d.contract_party_b_company_id,d.info_data=[{project_name:"",specifications:"",unit:"",quantity:"",unit_price:"",total_amount:"",tariff:"",tax:""},{project_name:"",specifications:"",unit:"",quantity:"",unit_price:"",total_amount:"",tariff:"",tax:""},{project_name:"",specifications:"",unit:"",quantity:"",unit_price:"",total_amount:"",tariff:"",tax:""}]),e.$store.state.company.companyList.map((function(t,i){t.id===d.payment_company_id&&(e.payInvoice_code=t.invoice_code),t.id===d.revenue_company_id&&(e.revenue_Invoice_code=t.invoice_code)})),e.$route.query.noRemark&&(d.remarks=""),e.reqParam=d),e.$route.query.detailToCreate&&(e.detailToCreate=e.$route.query.detailToCreate),(e.$route.query.from||e.withModal.from)&&(e.from=e.$route.query.from||e.withModal.from),e.$route.params.isAdmin||void 0===e.$route.params.isAdmin||(e.isAdmin=e.$route.params.isAdmin);case 37:case"end":return t.stop()}}),t)})))()},methods:{getOcrInfo:function(e){var t=e.data;this.invoicesType=-1===t.title.indexOf("专票")?"2":"1";var i=this.companyList.find((function(e){return e.name===t.purchaserName}));i&&(this.reqParam.payment_company_id=i.id);var a=this.companyList.find((function(e){return e.name===t.sellerName}));if(a&&(this.reqParam.revenue_company_id=a.id),t.totalAmountInWords&&(this.all_price_upCase=t.totalAmountInWords),t.totalAmount&&(this.reqParam.money=t.totalAmount),t.invoiceDetails){for(var n=[],r=0;r<t.invoiceDetails.length;r++)n.push({project_name:t.invoiceDetails[r].itemName,unit:t.invoiceDetails[r].unit,specifications:t.invoiceDetails[r].specification,quantity:t.invoiceDetails[r].quantity,unit_price:t.invoiceDetails[r].unitPrice,total_amount:t.invoiceDetails[r].amount,tariff:t.invoiceDetails[r].taxRate,tax:t.invoiceDetails[r].tax});this.reqParam.info_data=n}},toProjectDetail:function(){var e=this,t=e.permit_response.info;"未签约"===t.main_contract_id?Object(u["c"])(this,"NewProject",{data:JSON.stringify(t),type:"edit",isTop:t.istop}):Object(u["c"])(this,"projectDetail",{id:t.id,isTop:t.istop})},getPermitInfos:function(){var e=this;return Object(c["a"])(Object(o["a"])().mark((function t(){var i,a,n,c;return Object(o["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.permit_loading=!0,t.next=3,Object(s["z"])({id:(null===(i=e.withModal)||void 0===i?void 0:i.permit_id)||e.$route.query.permit_id});case 3:return a=t.sent,n=a.data.project_id,e.reqParam.is_project=!!n,e.reqParam.project_id=n,t.next=9,Object(l["e"])(n);case 9:c=t.sent,e.permit_response=Object(r["a"])(Object(r["a"])({},a.data),{},{info:c.data[0]||{}}),e.permit_loading=!1;case 12:case"end":return t.stop()}}),t)})))()},handleTop:function(e){var t=this;return Object(c["a"])(Object(o["a"])().mark((function e(){var i,a;return Object(o["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(s["a"])({id:(null===(i=t.withModal)||void 0===i?void 0:i.permit_id)||t.$route.query.id});case 2:a=e.sent,200===a.code&&(t.$message.success(a.msg),t.istop=!t.istop);case 4:case"end":return e.stop()}}),e)})))()},handleInvoicesAdd:function(){var e=arguments,t=this;return Object(c["a"])(Object(o["a"])().mark((function i(){var a,n,c,l;return Object(o["a"])().wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(a=e.length>0&&void 0!==e[0]&&e[0],!t.isAdmin){i.next=6;break}if(t.isAdd){i.next=6;break}if(t.reqParam.project_id){i.next=6;break}return t.$message({type:"warning",message:"请选择项目"}),i.abrupt("return");case 6:if(n=!1,t.reqParam.info_data.map((function(e){e.project_name&&e.unit&&e.quantity&&e.unit_price&&e.total_amount&&e.tariff&&e.tax&&(n=!0)})),n){i.next=11;break}return t.$message("请完整填写表格每一项"),i.abrupt("return");case 11:return c=Object(r["a"])(Object(r["a"])({},t.reqParam),{},{type:t.invoicesType,info_data:JSON.stringify(t.reqParam.info_data)}),i.next=14,Object(s["s"])(c);case 14:l=i.sent,l&&t.$message({type:"success",message:"添加成功"}),t.payInvoice_code="",t.revenue_Invoice_code="",t.reqParam={is_project:0,project_id:"",contract_id:"",type:"",payment_company_id:"",money:"",revenue_company_id:"",remarks:"",info_data:[{project_name:"",specifications:"",unit:"",quantity:"",unit_price:"",total_amount:"",tariff:"",tax:""},{project_name:"",specifications:"",unit:"",quantity:"",unit_price:"",total_amount:"",tariff:"",tax:""},{project_name:"",specifications:"",unit:"",quantity:"",unit_price:"",total_amount:"",tariff:"",tax:""}]},a?t.$emit("draftToCreate",t.withModal.id):(t.$emit("refreshList"),t.$emit("close"));case 20:case"end":return i.stop()}}),i)})))()},createDraft:function(){var e=this;return Object(c["a"])(Object(o["a"])().mark((function t(){var i,a;return Object(o["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,e.loading=!0,i=Object(r["a"])(Object(r["a"])({},e.reqParam),{},{type:e.invoicesType,info_data:JSON.stringify(e.reqParam.info_data)}),t.next=5,Object(m["a"])(i);case 5:a=t.sent,200===a.code?e.$message({type:"success",message:"添加成功"}):e.$message({type:"error",message:a.msg}),t.next=12;break;case 9:t.prev=9,t.t0=t["catch"](0),console.log("[保存发票草稿出错]",t.t0);case 12:return t.prev=12,e.loading=!1,t.finish(12);case 15:case"end":return t.stop()}}),t,null,[[0,9,12,15]])})))()},editContractDraft:function(){var e=this;return Object(c["a"])(Object(o["a"])().mark((function t(){var i,a;return Object(o["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.withModal.id){t.next=2;break}return t.abrupt("return");case 2:return t.prev=2,e.loading=!0,i=Object(r["a"])(Object(r["a"])({id:e.withModal.id},e.reqParam),{},{type:e.invoicesType,info_data:JSON.stringify(e.reqParam.info_data)}),t.next=7,Object(m["a"])(i);case 7:a=t.sent,200===a.code?e.$message({type:"success",message:"保存成功"}):e.$message({type:"error",message:a.msg}),t.next=14;break;case 11:t.prev=11,t.t0=t["catch"](2),console.log("[保存发票草稿出错]",t.t0);case 14:return t.prev=14,e.loading=!1,t.finish(14);case 17:case"end":return t.stop()}}),t,null,[[2,11,14,17]])})))()},handleInput:function(e,t,i){var a=this;this.$forceUpdate(),this.companyList.map((function(e,t){e.id==a.reqParam.payment_company_id&&(a.payInvoice_code=e.invoice_code),e.id==a.reqParam.revenue_company_id&&(a.revenue_Invoice_code=e.invoice_code)}));var n=0;if(this.reqParam.info_data.map((function(e){n=Number(n)+Number(e.total_amount)})),this.publicsNumToUpper(n),this.reqParam.money=n,i){var r=this.reqParam.info_data[t];switch(i){case"quantity":if(!e)return void(r.total_amount="");if(r.total_amount)r.unit_price=Object(d["a"])("".concat(r.total_amount,"/").concat(e));else{if(!r.unit_price)return;r.total_amount=Object(d["a"])("".concat(r.unit_price,"*").concat(e))}break;case"unit_price":if(!e)return void(r.total_amount="");if(!r.quantity)return;r.total_amount=Object(d["a"])("".concat(r.quantity,"*").concat(e));break;case"total_amount":if(!e)return r.tax="",void(r.unit_price="");r.quantity&&(r.unit_price=Object(d["a"])("".concat(e,"/").concat(r.quantity)));break;case"tariff":break;case"tax":break}r.tariff?r.total_amount&&(r.tax=Object(d["a"])("".concat(r.total_amount,"-(").concat(r.total_amount,"/(1+(").concat(r.tariff,"*0.01)))")).toFixed(5)):r.tax=""}},handlePass:function(e){var t=this;return Object(c["a"])(Object(o["a"])().mark((function e(){var i;return Object(o["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(l["j"])({id:t.stateId,type:"1"});case 2:i=e.sent,200===i.code&&(t.$message.success(i.msg),t.withModal?t.$emit("close"):t.$router.push({name:"pendApprovalList"}));case 4:case"end":return e.stop()}}),e)})))()},handleReject:function(e){var t=this;return Object(c["a"])(Object(o["a"])().mark((function e(){var i;return Object(o["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(l["j"])({id:t.stateId,type:"2"});case 2:i=e.sent,200===i.code&&(t.$message.success(i.msg),t.withModal?t.$emit("close"):t.$router.push({name:"pendApprovalList"}));case 4:case"end":return e.stop()}}),e)})))()},publicsNumToUpper:function(e){var t=this;return Object(c["a"])(Object(o["a"])().mark((function i(){var a;return Object(o["a"])().wrap((function(i){while(1)switch(i.prev=i.next){case 0:return i.next=2,Object(s["A"])({number:e});case 2:a=i.sent,t.all_price_upCase=a.data.str;case 4:case"end":return i.stop()}}),i)})))()},handleAddItem:function(){console.log("this.reqParam.info_data",this.reqParam.info_data),this.reqParam.info_data.push({project_name:"",specifications:"",unit:"",quantity:"",unit_price:"",total_amount:"",tariff:"",tax:""})},getCompanyList:function(){var e=this;return Object(c["a"])(Object(o["a"])().mark((function t(){var i,a,n;return Object(o["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,e.loading=!0,t.next=4,Object(s["n"])();case 4:return i=t.sent,t.next=7,Object(s["m"])();case 7:return a=t.sent,t.next=10,Object(s["l"])();case 10:n=t.sent,e.companyList=i.data,e.$store.commit("company/setCompanyList",i.data),e.projectList=a.data,e.$store.commit("company/setProjectList",a.data),0==e.reqParam.is_project&&(e.contractList=n.data,e.$store.commit("company/setContractList",n.data)),t.next=21;break;case 18:t.prev=18,t.t0=t["catch"](0),console.error(t.t0);case 21:return t.prev=21,e.loading=!1,t.finish(21);case 24:case"end":return t.stop()}}),t,null,[[0,18,21,24]])})))()},handleSelectChange:function(e,t){var i=this;if("project"===t){if(0==this.reqParam.is_project)return;this.reqParam.contract_id="",this.reqParam.payment_company_id="",this.reqParam.revenue_company_id="",this.payInvoice_code="",this.revenue_Invoice_code="",Object(s["l"])({project_id:e}).then((function(e){i.contractList=e.data}))}else{this.$forceUpdate();var a=this.contractList.find((function(t){return t.id==e}));a?(this.reqParam.payment_company_id=a.contract_party_a_company_id,this.reqParam.revenue_company_id=a.contract_party_b_company_id):(this.reqParam.payment_company_id="",this.reqParam.revenue_company_id="",this.payInvoice_code="",this.revenue_Invoice_code="")}},handleIsProjectChange:function(e){var t=this;this.reqParam.contract_id="",this.reqParam.project_id="",this.reqParam.payment_company_id="",this.reqParam.revenue_company_id="",this.payInvoice_code="",this.revenue_Invoice_code="",0==e&&Object(s["l"])().then((function(e){t.contractList=e.data}))}}},h=_,x=(i("1959"),i("2877")),y=Object(x["a"])(h,a,n,!1,null,"745e4b67",null);t["default"]=y.exports},"267e":function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var a={FROM_TREE_TO_INVOICE:"FROM_TREE_TO_INVOICE",FROM_DASHBOARD_TO_APPROVAL:"FROM_DASHBOARD_TO_APPROVAL",FROM_TREE_TO_TRANSFER:"FROM_TREE_TO_TRANSFER",FROM_TREE_TO_INVOICE_LIST:"FROM_TREE_TO_INVOICE_LIST",FROM_TREE_TO_TRANSFER_CREATE:"FROM_TREE_TO_TRANSFER_CREATE"}},"38d4":function(e,t,i){"use strict";i.d(t,"h",(function(){return n})),i.d(t,"i",(function(){return r})),i.d(t,"g",(function(){return o})),i.d(t,"b",(function(){return c})),i.d(t,"f",(function(){return s})),i.d(t,"a",(function(){return l})),i.d(t,"e",(function(){return d})),i.d(t,"c",(function(){return p})),i.d(t,"d",(function(){return u}));var a=i("b775");function n(e){return Object(a["a"])({url:"/Invoices/getList",method:"post",data:e})}function r(e){return Object(a["a"])({url:"/Invoices/offsetRed",method:"post",data:e})}function o(e){return Object(a["a"])({url:"/Invoices/cancel",method:"post",data:e})}function c(e){return Object(a["a"])({url:"/BusinessExpensess/getStatistics",method:"post",data:e})}function s(e){return Object(a["a"])({url:"/Invoices/getDraftList",method:"post",data:e})}function l(e){return Object(a["a"])({url:e.id?"/Invoices/editDraft":"/Invoices/draftAdd",method:"post",data:e})}function d(e){return Object(a["a"])({url:"/Invoices/draftInfo?id=".concat(e.id),method:"post",data:e})}function p(e){return Object(a["a"])({url:"/Invoices/draftDel",method:"post",data:e})}var u=function(e){var t=new FormData;return t.append("files",e),Object(a["a"])({url:"/Publics/recognizeInvoice",method:"post",data:t})}},"9a04":function(e,t,i){e.exports=i.p+"static/img/checking.73c367ae.png"},ac6f:function(e,t,i){e.exports=i.p+"static/img/refuted.d21e0353.png"},ed08:function(e,t,i){"use strict";i.d(t,"b",(function(){return r})),i.d(t,"a",(function(){return o})),i.d(t,"c",(function(){return c}));i("53ca"),i("d81d"),i("a434"),i("d3b7"),i("4d63"),i("ac1f"),i("2c3e"),i("00b4"),i("25f0"),i("4d90"),i("5319"),i("0643"),i("4e3e"),i("a573"),i("159b");var a=i("21a6"),n=i("25ca");i("bc3a"),i("aeb1");function r(e,t,i,r){var o=[],c=[],s=function(e){var t=0;for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t++;return t};for(var l in e)if(console.log("------------------------"),Object.prototype.hasOwnProperty.call(e,l)){var d=e[l],p=[];for(var u in d)if(Object.prototype.hasOwnProperty.call(d,u)){var m=d[u];p.push(m),c.length<s(d)&&c.push(u)}o.push(p)}var f=[];i.map((function(e,t){"快速操作"!=e&&"详情"!=e&&f.push(e)})),o.splice(0,0,c,f),console.log("excel_data",n);var _=n["utils"].aoa_to_sheet(o),h=n["utils"].book_new(),x=[{hidden:!0}];_["!rows"]=x,n["utils"].book_append_sheet(h,_,r);var y=n["write"](h,{bookType:"xlsx",type:"array"}),v=new Blob([y],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=UTF-8"});Object(a["saveAs"])(v,t+".xlsx")}function o(e){var t=-1!==e.lastIndexOf("?")?decodeURIComponent(e.substring(e.lastIndexOf("/")+1,e.lastIndexOf("?"))):decodeURIComponent(e.substring(e.lastIndexOf("/")+1)),i=t.substring(t.lastIndexOf(".")+1);if("png"==i||"jpg"==i||"pdf"==i){var n=document.createElement("a");n.href=e,n.download=t,n.target="_blank",n.click()}else fetch(e,{mode:"no-cors"}).then((function(e){return e.blob()})).then((function(e){console.log("blob",e),Object(a["saveAs"])(e,t)}))}function c(e,t,i){console.log("self",e);var a=e.$router.resolve({name:t,query:i}),n=window.open(a.href,t);n&&n.location.reload()}}}]);