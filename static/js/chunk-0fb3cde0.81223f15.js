(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0fb3cde0"],{"0993":function(e,t,r){e.exports=r.p+"static/img/checked.f8521b5f.png"},"396d":function(e,t,r){"use strict";r("e4af")},"75c8":function(e,t,r){"use strict";r("e3d4")},"9a04":function(e,t,r){e.exports=r.p+"static/img/checking.73c367ae.png"},"9df0":function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"companyDetail"},[r("div",{staticClass:"newTitle"},[e._v(e._s(e.isEdit?"编辑公司":"创建公司"))]),r("el-form",{ref:"ruleForm",staticClass:"newApprovalForm",attrs:{model:e.ruleForm,rules:e.rules,"label-width":"150px",size:"medium"}},[r("div",{staticClass:"msgTwo"},[r("div",{staticClass:"invoiceMsg"},[r("div",{staticClass:"invoiceMsgTitle"},[e._v("基础信息")]),r("el-form-item",{attrs:{label:"公司归属",prop:"company_ascription",filterable:"",clearable:""}},[r("el-select",{attrs:{placeholder:"请选择"},model:{value:e.ruleForm.company_ascription,callback:function(t){e.$set(e.ruleForm,"company_ascription",t)},expression:"ruleForm.company_ascription"}},e._l(e.companyBelongArr,(function(e,t){return r("el-option",{key:t,attrs:{label:e.label,value:e.value}})})),1)],1),r("el-form-item",{attrs:{label:"公司名称",prop:"name"}},[r("el-input",{attrs:{title:e.ruleForm.name,placeholder:"请输入"},on:{blur:e.nameBlur,change:e.nameSyncToOtherForm},model:{value:e.ruleForm.name,callback:function(t){e.$set(e.ruleForm,"name",t)},expression:"ruleForm.name"}})],1),r("el-form-item",{attrs:{label:"公司法人",prop:"corporation"}},[r("el-input",{attrs:{placeholder:"请输入"},model:{value:e.ruleForm.corporation,callback:function(t){e.$set(e.ruleForm,"corporation",t)},expression:"ruleForm.corporation"}})],1),r("el-form-item",{attrs:{label:"注册资金",prop:"registered_capital"}},[r("el-input-number",{attrs:{min:0,step:"0.01",precision:"2",placeholder:"请输入"},model:{value:e.ruleForm.registered_capital,callback:function(t){e.$set(e.ruleForm,"registered_capital",t)},expression:"ruleForm.registered_capital"}})],1),r("el-form-item",{attrs:{label:"公司类型",prop:"company_type",filterable:"",clearable:""}},[r("el-select",{attrs:{placeholder:"请选择"},model:{value:e.ruleForm.company_type,callback:function(t){e.$set(e.ruleForm,"company_type",t)},expression:"ruleForm.company_type"}},e._l(e.companyTypeArr,(function(e,t){return r("el-option",{key:t,attrs:{label:e.label,value:e.value}})})),1)],1),r("el-form-item",{attrs:{label:"公司负责人",prop:"contacts_id"}},[r("el-select",{attrs:{filterable:"",placeholder:"请选择",clearable:""},model:{value:e.ruleForm.contacts_id,callback:function(t){e.$set(e.ruleForm,"contacts_id",t)},expression:"ruleForm.contacts_id"}},e._l(e.staffList,(function(e){return r("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),r("AddressComponent",{ref:"address",attrs:{data:e.addressObj}}),r("el-form-item",{attrs:{label:"详细地址",prop:"address"}},[r("el-input",{attrs:{title:e.ruleForm.address,placeholder:"请输入"},model:{value:e.ruleForm.address,callback:function(t){e.$set(e.ruleForm,"address",t)},expression:"ruleForm.address"}})],1)],1),r("div",{staticClass:"invoiceMsg"},[r("div",{staticClass:"invoiceMsgTitle"},[e._v("扩展档案管理")]),r("el-form-item",{attrs:{label:"营业执照"}},[r("el-upload",{staticClass:"upload-demo",attrs:{action:"##","file-list":e.fileList,"before-upload":e.beforUpload,"on-remove":e.handleRemove,"before-remove":e.beforeRemove,"on-preview":e.handleDown}},[r("el-button",{attrs:{size:"small",type:"primary"}},[e._v("点击上传")])],1)],1),r("el-form-item",{attrs:{label:"生产或代理设备品牌",prop:"brand"}},[r("el-input",{attrs:{title:e.ruleForm.brand,type:"textarea",rows:2,placeholder:"请输入"},model:{value:e.ruleForm.brand,callback:function(t){e.$set(e.ruleForm,"brand",t)},expression:"ruleForm.brand"}})],1),r("el-form-item",{attrs:{label:"实施交付能力",prop:"deliverability"}},[r("el-input",{attrs:{title:e.ruleForm.deliverability,type:"textarea",rows:2,placeholder:"请输入"},model:{value:e.ruleForm.deliverability,callback:function(t){e.$set(e.ruleForm,"deliverability",t)},expression:"ruleForm.deliverability"}})],1)],1)]),r("div",{staticClass:"invoiceMsg"},[r("div",{staticClass:"invoiceMsgTitle"},[e._v("开票信息")]),r("el-form-item",{attrs:{label:"公司名称",prop:"invoice_company_name"}},[r("el-input",{attrs:{title:e.ruleForm.invoice_company_name,placeholder:"请输入"},model:{value:e.ruleForm.invoice_company_name,callback:function(t){e.$set(e.ruleForm,"invoice_company_name",t)},expression:"ruleForm.invoice_company_name"}})],1),r("el-form-item",{attrs:{label:"社会统一信用代码",prop:"invoice_code"}},[r("el-input",{attrs:{title:e.ruleForm.invoice_code,placeholder:"请输入"},model:{value:e.ruleForm.invoice_code,callback:function(t){e.$set(e.ruleForm,"invoice_code",t)},expression:"ruleForm.invoice_code"}}),r("span",{staticStyle:{color:"red","padding-top":"10px"}},[e._v("开具专用发票需填写以下信息")])],1),r("el-form-item",{attrs:{label:"开户行"}},[r("el-input",{attrs:{title:e.ruleForm.invoice_open_bank,placeholder:"请输入"},model:{value:e.ruleForm.invoice_open_bank,callback:function(t){e.$set(e.ruleForm,"invoice_open_bank",t)},expression:"ruleForm.invoice_open_bank"}})],1),r("el-form-item",{attrs:{label:"账号"}},[r("el-input",{attrs:{title:e.ruleForm.invoice_bank_number,placeholder:"请输入"},model:{value:e.ruleForm.invoice_bank_number,callback:function(t){e.$set(e.ruleForm,"invoice_bank_number",t)},expression:"ruleForm.invoice_bank_number"}})],1),r("el-form-item",{attrs:{label:"电话"}},[r("el-input",{attrs:{title:e.ruleForm.invoice_tel,placeholder:"请输入"},model:{value:e.ruleForm.invoice_tel,callback:function(t){e.$set(e.ruleForm,"invoice_tel",t)},expression:"ruleForm.invoice_tel"}})],1),r("el-form-item",{attrs:{label:"地址"}},[r("el-input",{attrs:{title:e.ruleForm.invoice_address,placeholder:"请输入"},model:{value:e.ruleForm.invoice_address,callback:function(t){e.$set(e.ruleForm,"invoice_address",t)},expression:"ruleForm.invoice_address"}})],1)],1),r("div",{staticClass:"invoiceMsg",staticStyle:{border:"none"}},[e.handleAddBackBtn?r("el-button",{attrs:{type:"primary"},on:{click:e.handleAddBack}},[e._v("添加银行账户")]):e._e()],1),e._l(e.ruleForm.bank,(function(t,a){return e.handleAddBackBtn?e._e():r("div",{key:a,staticClass:"invoiceMsg"},[r("div",{staticStyle:{display:"flex"}},[r("div",{staticClass:"invoiceMsgTitle"},[e._v("银行账户信息")]),r("div",{staticClass:"invoiceMsgAddIcon",on:{click:e.addTable}},[e._v(" + ")]),t.id?e._e():r("div",{staticClass:"invoiceMsgDeleteIcon",staticStyle:{"margin-left":"20px"},on:{click:function(t){return e.deleteTable(a)}}},[e._v(" - ")]),e.isEdit&&t.id?r("el-button",{staticStyle:{"margin-left":"120px","margin-bottom":"10px"},attrs:{size:"mini",type:"danger"},on:{click:function(r){return e.delMsg(t.id)}}},[e._v("删除银行账户信息")]):e._e()],1),r("el-form",{ref:"bank"+a,refInFor:!0,attrs:{model:t,"label-width":"150px"}},[r("el-form-item",{attrs:{label:"账户名称",prop:"account_name",required:""}},[r("el-input",{attrs:{title:t.account_name},model:{value:t.account_name,callback:function(r){e.$set(t,"account_name",r)},expression:"bank.account_name"}})],1),r("el-form-item",{attrs:{label:"开户行",prop:"open_bank",required:""}},[r("el-input",{attrs:{title:t.open_bank},model:{value:t.open_bank,callback:function(r){e.$set(t,"open_bank",r)},expression:"bank.open_bank"}})],1),r("el-form-item",{attrs:{label:"银行账号",prop:"bank_number",required:"",rules:[{validator:e.checkBankAccount,trigger:"blur"}]}},[r("el-input",{attrs:{title:t.bank_number,oninput:"value=value.replace(/[^\\d]/g,'')"},model:{value:t.bank_number,callback:function(r){e.$set(t,"bank_number",r)},expression:"bank.bank_number"}})],1),r("el-form-item",{attrs:{label:"行号",prop:"bank_no"}},[r("el-input",{attrs:{title:t.bank_no},model:{value:t.bank_no,callback:function(r){e.$set(t,"bank_no",r)},expression:"bank.bank_no"}})],1),r("el-form-item",{attrs:{label:"备注信息"}},[r("el-input",{attrs:{title:t.remarks,type:"textarea",rows:2},model:{value:t.remarks,callback:function(r){e.$set(t,"remarks",r)},expression:"bank.remarks"}})],1)],1)],1)})),r("div",{staticClass:"invoiceMsg"},[r("div",{staticClass:"invoiceMsgTitle"},[e._v("现金账户信息")]),r("el-form-item",{attrs:{label:"账户名称"}},[r("el-input",{attrs:{title:e.ruleForm.cash_account_name,placeholder:"请输入"},model:{value:e.ruleForm.cash_account_name,callback:function(t){e.$set(e.ruleForm,"cash_account_name",t)},expression:"ruleForm.cash_account_name"}})],1),r("el-form-item",{attrs:{label:"保管人"}},[r("el-select",{attrs:{filterable:"",placeholder:"请选择",clearable:""},model:{value:e.ruleForm.cash_custodian,callback:function(t){e.$set(e.ruleForm,"cash_custodian",t)},expression:"ruleForm.cash_custodian"}},e._l(e.staffList,(function(e){return r("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1)],1),r("div",{staticStyle:{margin:"0 0 40px 200px","text-align":"center"}},[r("el-button",{staticStyle:{"margin-top":"12px"},attrs:{loading:e.subLoading,type:"primary"},on:{click:function(t){return e.nextStep("ruleForm")}}},[e._v("下一步")])],1)],2)],1)},o=[],n=r("5530"),i=r("c7eb"),l=r("1da1"),c=(r("caad"),r("d81d"),r("a434"),r("b0c0"),r("e9c4"),r("a9e3"),r("b64b"),r("d3b7"),r("a573"),r("d041")),s=r("9437"),u=r("277f"),p=r("2f62"),m={components:{AddressComponent:c["a"]},props:{openOrigin:{type:Number,default:0},withModal:{type:Object,default:void 0}},data:function(){var e=this,t=null,r=function(r,a){var o;r&&r!==(null===(o=e.withModal)||void 0===o?void 0:o.company_name)?(t&&clearTimeout(t),t=setTimeout(Object(l["a"])(Object(i["a"])().mark((function e(){return Object(i["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:Object(u["g"])({name:r}).then((function(e){var r;t=null,1!==(null===(r=e.data)||void 0===r?void 0:r.is_exist)?a():a(new Error("公司名称重复"))}));case 1:case"end":return e.stop()}}),e)}))),500)):a()},a=function(e,t,a){r(t,a)};return{checkThrottle:null,subLoading:!1,handleAddBackBtn:!0,valueFlag:!1,id:"",isEdit:!1,fileUrl:"",fileList:[],addressObj:{labelAddress:"地区定位",province:"",city:"",area:""},companyBelongArr:[{value:"1",label:"集团公司"},{value:"2",label:"合作公司"}],companyTypeArr:[{value:"1",label:"一般纳税人"},{value:"2",label:"小规模公司"},{value:"3",label:"个体工商户"},{value:"4",label:"其它"}],ruleForm:{name:"",company_ascription:"",company_type:"",contacts_id:"",corporation:"",registered_capital:"",province:"",city:"",area:"",address:"",business_license:[],brand:"",deliverability:"",invoice_company_name:"",invoice_code:"",invoice_open_bank:"",invoice_bank_number:"",invoice_tel:"",invoice_address:"",cash_account_name:"",cash_custodian:"",bank:[]},rules:{contacts_id:[{required:!0,message:"请输入公司项目负责人",trigger:"blur"}],corporation:[{required:!0,message:"请输入法人",trigger:"blur"}],registered_capital:[{required:!0,message:"请输入注册资金",trigger:"blur"},{type:"number",message:"注册资金必须为数字值"},{type:"number",min:0,message:"注册资金必须大于等于0",trigger:"blur"}],invoice_company_name:[{required:!0,message:"请输入公司名称",trigger:"blur"}],invoice_code:[{required:!0,message:"请输入社会统一信用代码",trigger:"blur"}],invoice_open_bank:[{required:!0,message:"请输入开户行",trigger:"blur"}],invoice_bank_number:[{required:!0,message:"请输入账号",trigger:"blur"}],invoice_address:[{required:!0,message:"请输入地址",trigger:"blur"}],account_name:[{required:!0,message:"请输入账户名称",trigger:"blur"}],open_bank:[{required:!0,message:"请输入开户行",trigger:"blur"}],bank_number:[{required:!0,message:"请输入银行账户",trigger:"blur"}],company_ascription:[{required:!0,message:"请选择公司归属",trigger:"change"}],name:[{required:!0,message:"请输入公司名称",trigger:"blur"},{validator:a,trigger:"blur"}],company_type:[{required:!0,message:"请选择公司类型",trigger:"change"}]}}},computed:{staffList:function(){return this.$store.state.company.staffList}},mounted:function(){this.withModal?this.withModal.id&&(this.id=this.withModal.id,this.getEditFun({id:this.withModal.id}),this.isEdit=!!this.withModal.id):this.$route.params.id&&(this.id=this.$route.params.id,this.getEditFun({id:this.$route.params.id}),this.isEdit=!!this.$route.params.id)},methods:Object(n["a"])(Object(n["a"])({},Object(p["c"])("app",["OPEN_PREVIEW"])),{},{checkBankAccount:function(e,t,r){var a=this;t?Object(u["f"])({bank_number:t,company_id:a.id||0}).then((function(e){var t;null!==(t=e.data)&&void 0!==t&&t.is_exist?r(new Error("银行账户重复")):r()}),(function(e){r(new Error(e))})):r("请输入银行账户")},nameSyncToOtherForm:function(e){this.ruleForm.invoice_company_name||(this.ruleForm.invoice_company_name=e)},handleAddBack:function(){this.handleAddBackBtn=!1,this.ruleForm.bank.push({account_name:this.ruleForm.name,open_bank:"",bank_number:"",bank_no:""})},delMsg:function(e){var t=this;return Object(l["a"])(Object(i["a"])().mark((function r(){var a;return Object(i["a"])().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,Object(u["u"])({id:e});case 2:a=r.sent,200===a.code&&t.getEditFun({id:t.id});case 4:case"end":return r.stop()}}),r)})))()},handleDown:function(e){var t,r=e.name.split(".").pop();["pdf"].includes(r)&&(t="pdf"),["doc","docx"].includes(r)&&(t="doc"),["png","jpg","jpeg","gif","bmp"].includes(r)&&(t="pic"),this.OPEN_PREVIEW({url:e.url,type:t})},nameBlur:function(){this.ruleForm.cash_account_name=this.ruleForm.name},getEditFun:function(e){var t=this;this.$store.dispatch("company/getDetails",Object(n["a"])({},e)).then((function(e){console.log("ResponseResponseResponse",e),t.ruleForm=null===e||void 0===e?void 0:e.data,t.ruleForm.company_ascription=t.ruleForm.company_ascription+"",t.ruleForm.company_type=t.ruleForm.company_type+"",t.ruleForm.bank.length?(t.valueFlag=!0,t.handleAddBackBtn=!1):t.handleAddBackBtn=!0,console.log("bankbankbankbankbankbank",t.ruleForm.bank),t.fileList=t.ruleForm.business_license?JSON.parse(t.ruleForm.business_license).map((function(e){return{url:e,name:t.getFileName(e)}})):[],t.addressObj={labelAddress:"地区定位",province:null===e||void 0===e?void 0:e.data.province,city:null===e||void 0===e?void 0:e.data.city,area:null===e||void 0===e?void 0:e.data.area},console.log("123",t.ruleForm)}))},addTable:function(e){this.ruleForm.bank.push({account_name:this.ruleForm.name,open_bank:"",bank_number:"",bank_no:""})},deleteTable:function(e,t){"input"===t&&this.ruleForm.arr.splice(e,1),this.ruleForm.bank.splice(e,1),0===this.ruleForm.bank&&(this.handleAddBackBtn=!0)},nextStep:function(e){var t=this;return Object(l["a"])(Object(i["a"])().mark((function r(){return Object(i["a"])().wrap((function(r){while(1)switch(r.prev=r.next){case 0:t.$refs[e].validate((function(e){var r=t.$refs.address.getFormData();if(e){var a=t;if(console.log("this.ruleForm.bank",a.ruleForm.bank),a.ruleForm.bank.length){var o=!0;if(a.ruleForm.bank.map((function(e){(e.money||0===e.money)&&delete e.money,(e.state||0===e.state)&&delete e.state,(e.status||0===e.status)&&delete e.status,(e.update_time||0===e.update_time)&&delete e.update_time,(e.create_time||0===e.create_time)&&delete e.create_time,(e.delete_time||0===e.delete_time)&&delete e.delete_time,""!==e.account_name&&""!==e.bank_number&&""!==e.open_bank||(a.$message("请完整填写银行账户信息"),o=!1)})),o){a.subLoading=!0,a.ruleForm.bank.map((function(e){var r;e.company_id=(null===(r=t.withModal)||void 0===r?void 0:r.id)||t.$route.params.id}));var n=a.isEdit?"company/updateCompany":"company/addCompany";console.log("actionType",n),a.$store.dispatch(n,{id:a.isEdit?a.ruleForm.id:"",name:a.ruleForm.name,company_ascription:a.ruleForm.company_ascription,company_type:a.ruleForm.company_type,contacts_id:a.ruleForm.contacts_id+"",province:r.baseInfo&&r.baseInfo.province+"",city:r.baseInfo&&r.baseInfo.city+"",area:r.baseInfo&&r.baseInfo.area+"",business_license:JSON.stringify(a.fileList.map((function(e){return e.url}))),brand:a.ruleForm.brand,address:a.ruleForm.address,invoice_code:a.ruleForm.invoice_code,deliverability:a.ruleForm.deliverability,invoice_company_name:a.ruleForm.invoice_company_name,invoice_open_bank:a.ruleForm.invoice_open_bank,invoice_bank_number:a.ruleForm.invoice_bank_number,invoice_tel:a.ruleForm.invoice_tel,invoice_address:a.ruleForm.invoice_address,cash_account_name:a.ruleForm.cash_account_name,cash_custodian:a.ruleForm.cash_custodian,bank:JSON.stringify(a.ruleForm.bank)}).then(function(){var e=Object(l["a"])(Object(i["a"])().mark((function e(r){return Object(i["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(200!==r.code){e.next=12;break}if(1!==t.openOrigin){e.next=6;break}return e.next=4,t.$store.dispatch("company/updateAll","company");case 4:return t.$emit("afterCreate",r.data.id),e.abrupt("return");case 6:a.$router.push({name:"CompanyList"}),a.$emit("close"),a.$emit("refreshList"),a.$store.dispatch("company/updateAll","company"),e.next=13;break;case 12:a.$message(r.message);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).finally((function(){a.subLoading=!1}))}}else{var c=a.isEdit?"company/updateCompany":"company/addCompany";console.log("actionType",c),a.subLoading=!0,t.$store.dispatch(c,{id:a.isEdit?t.ruleForm.id:"",name:t.ruleForm.name,company_ascription:t.ruleForm.company_ascription,company_type:t.ruleForm.company_type,contacts_id:t.ruleForm.contacts_id+"",province:r.baseInfo&&r.baseInfo.province+"",city:r.baseInfo&&r.baseInfo.city+"",area:r.baseInfo&&r.baseInfo.area+"",business_license:JSON.stringify(a.fileList.map((function(e){return e.url}))),brand:t.ruleForm.brand,address:t.ruleForm.address,invoice_code:t.ruleForm.invoice_code,deliverability:t.ruleForm.deliverability,invoice_company_name:t.ruleForm.invoice_company_name,invoice_open_bank:t.ruleForm.invoice_open_bank,invoice_bank_number:t.ruleForm.invoice_bank_number,invoice_tel:t.ruleForm.invoice_tel,invoice_address:t.ruleForm.invoice_address,cash_account_name:t.ruleForm.cash_account_name,cash_custodian:t.ruleForm.cash_custodian,bank:JSON.stringify(t.ruleForm.bank)}).then(function(){var e=Object(l["a"])(Object(i["a"])().mark((function e(r){return Object(i["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(200!==r.code){e.next=11;break}if(1!==t.openOrigin){e.next=6;break}return e.next=4,t.$store.dispatch("company/updateAll","company");case 4:return t.$emit("afterCreate",r.data.id),e.abrupt("return");case 6:a.$emit("close"),a.$emit("refreshList"),t.$store.dispatch("company/updateAll","company"),e.next=12;break;case 11:t.$message(r.message);case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).finally((function(){a.subLoading=!1}))}}}));case 1:case"end":return r.stop()}}),r)})))()},getValue:function(e){},beforUpload:function(e){var t=this,r=new FormData;return r.append("files",e),Object(s["a"])(r).then((function(r){200===r.code&&(e.url=r.data.file,t.fileList.push(e))})),!1},handleRemove:function(e,t){this.fileList=t},beforeRemove:function(){},getFileName:function(e){return-1!==e.lastIndexOf("?")?decodeURIComponent(e.substring(e.lastIndexOf("/")+1,e.lastIndexOf("?"))):decodeURIComponent(e.substring(e.lastIndexOf("/")+1))}})},d=m,b=(r("396d"),r("2877")),_=Object(b["a"])(d,a,o,!1,null,"690b6592",null);t["default"]=_.exports},ac6f:function(e,t,r){e.exports=r.p+"static/img/refuted.d21e0353.png"},d797:function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"newApproval"},[a("div",{staticClass:"newTitle",staticStyle:{display:"flex","align-items":"center"}},[e._v(e._s(e.type?"详情":"新建项目")+" "),e.permit_type_name?a("span",{staticStyle:{"padding-left":"20px",color:"#666666"}},[e._v("审批事项："+e._s(e.permit_type_name))]):e._e(),e.showIsTop?a("el-button",{key:e.istop,staticStyle:{"margin-left":"50px"},attrs:{size:"small",type:"primary"},on:{click:e.handleTop}},[e._v(e._s(e.istop?"取消置顶":"置顶主页"))]):e._e()],1),e.showSubmitBtn?e._e():a("div",{staticStyle:{position:"absolute",top:"50px",right:"300px","z-index":"10"}},["已审批"==e.state_name?a("img",{staticStyle:{display:"block",width:"150px"},attrs:{src:r("0993"),alt:""}}):e._e(),"审批中"==e.state_name?a("img",{staticStyle:{display:"block",width:"150px"},attrs:{src:r("9a04"),alt:""}}):e._e(),"已驳回"==e.state_name?a("img",{staticStyle:{display:"block",width:"150px"},attrs:{src:r("ac6f"),alt:""}}):e._e()]),a("ProgressBar",{attrs:{active:e.active,arr:e.arr}}),a("div",{staticStyle:{width:"650px",margin:"0 auto"}},["1"==e.steps?a("el-form",{ref:"ruleForm",staticClass:"newApprovalForm",attrs:{model:e.ruleForm,rules:e.rules,"label-width":"100px",size:"medium",disabled:"audit"===e.type||!1===e.withModal.editable||!1,"label-position":"left"}},[a("el-form-item",{attrs:{label:"项目类型",prop:"projectType"}},[a("el-select",{attrs:{placeholder:"请选择",filterable:"",clearable:""},model:{value:e.ruleForm.projectType,callback:function(t){e.$set(e.ruleForm,"projectType",t)},expression:"ruleForm.projectType"}},e._l(e.ruleForm.projectTypeArray,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),a("el-form-item",{attrs:{label:"项目金额",prop:"projectMoney"}},[a("el-input",{attrs:{title:e.ruleForm.projectMoney,placeholder:"请输入"},model:{value:e.ruleForm.projectMoney,callback:function(t){e.$set(e.ruleForm,"projectMoney",t)},expression:"ruleForm.projectMoney"}}),a("span",[e._v("元")])],1),a("el-form-item",{attrs:{label:"项目负责人",prop:"projectMan"}},[a("div",{staticClass:"flex flex-row justify-start items-center"},[a("el-select",{attrs:{filterable:"",placeholder:"请选择",clearable:""},model:{value:e.ruleForm.projectMan,callback:function(t){e.$set(e.ruleForm,"projectMan",t)},expression:"ruleForm.projectMan"}},e._l(e.staffList,(function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1),a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.show_create_person=!0}}},[e._v("新建")])],1)]),a("el-form-item",{attrs:{label:"甲方",prop:"projectUnit"}},[a("div",{staticClass:"flex flex-row justify-start items-center"},[a("el-select",{attrs:{placeholder:"请选择",filterable:"",clearable:""},model:{value:e.ruleForm.projectUnit,callback:function(t){e.$set(e.ruleForm,"projectUnit",t)},expression:"ruleForm.projectUnit"}},e._l(e.companyList,(function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.openCreateCompany(1)}}},[e._v("新建")])],1)]),a("el-form-item",{attrs:{label:"乙方",prop:"bid_company_id"}},[a("div",{staticClass:"flex flex-row justify-start items-center"},[a("el-select",{attrs:{placeholder:"请选择",filterable:"",clearable:""},model:{value:e.ruleForm.bid_company_id,callback:function(t){e.$set(e.ruleForm,"bid_company_id",t)},expression:"ruleForm.bid_company_id"}},e._l(e.companyList,(function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.openCreateCompany(2)}}},[e._v("新建")])],1)]),a("el-form-item",{class:"edit"===e.type?"creatBtn1":"creatBtn",attrs:{label:"项目编号",prop:"projectNo"}},[a("el-input",{attrs:{title:e.ruleForm.projectNo,placeholder:"请输入"},model:{value:e.ruleForm.projectNo,callback:function(t){e.$set(e.ruleForm,"projectNo",t)},expression:"ruleForm.projectNo"}}),"edit"!==e.type?a("el-button",{staticClass:"btn",on:{click:function(t){return e.createProjectNo()}}},[e._v("自动生成")]):e._e()],1),a("el-form-item",{class:"edit"===e.type?"creatBtn1":"creatBtn",attrs:{label:"项目名称",prop:"projectName"}},[a("el-input",{attrs:{title:e.ruleForm.projectName,placeholder:"请输入"},model:{value:e.ruleForm.projectName,callback:function(t){e.$set(e.ruleForm,"projectName",t)},expression:"ruleForm.projectName"}}),"create"===e.type?a("el-button",{staticClass:"btn",on:{click:function(t){return e.createProjectName()}}},[e._v("自动生成")]):e._e()],1),a("el-form-item",{attrs:{label:"备注"}},[a("el-input",{attrs:{type:"textarea",rows:2,placeholder:"请输入"},model:{value:e.ruleForm.remarks,callback:function(t){e.$set(e.ruleForm,"remarks",t)},expression:"ruleForm.remarks"}})],1),a("div",{staticClass:"nextBtn"},["create"===e.type||e.showSubmitBtn?a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.nextStep("ruleForm")}}},[e._v("下一步")]):e._e()],1)],1):e._e(),e.canyuShow?a("div",[e.showSubmitBtn||0!=e.state&&3!=e.state?e._e():a("div",{staticClass:"action",staticStyle:{"text-align":"center"}},[a("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.handlePass(e.state)}}},[e._v("通过")]),a("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(t){return e.handleReject(e.state)}}},[e._v("驳回")]),e.permit_response&&void 0!==e.permit_response.project_id?a("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.toProjectDetail}},[e._v("Go项目脑图审批")]):e._e()],1)]):e._e(),"2"==e.steps?a("div",[a("createComplete",{attrs:{"back-word":"返回列表","go-to-word":"再次填写",tips:"操作","handle-back":e.handleBack,recreate:e.Recreate}})],1):e._e()],1),a("el-dialog",{attrs:{modal:!1,title:"创建人员",visible:e.show_create_person,"destroy-on-close":""},on:{"update:visible":function(t){e.show_create_person=t}}},[a("div",{staticClass:"createContainer"},[a("personal-create",{attrs:{"open-origin":1},on:{afterCreate:e.handleAfterCreate}})],1)]),a("el-dialog",{attrs:{modal:!1,title:"创建公司",width:"85vw",visible:e.show_create_company,"destroy-on-close":""},on:{"update:visible":function(t){e.show_create_company=t}}},[a("div",{staticClass:"createContainer"},[a("company-detail",{attrs:{"open-origin":1},on:{afterCreate:e.handleAfterCompanyCreate}})],1)])],1)},o=[],n=r("c7eb"),i=r("5530"),l=r("1da1"),c=(r("7db0"),r("b0c0"),r("e9c4"),r("b64b"),r("d3b7"),r("0643"),r("fffc"),r("fef7")),s=r("ba84"),u=r("277f"),p=r("429f"),m=r("cbbc"),d=r("9df0"),b=r("ed08"),_={components:{createComplete:s["a"],ProgressBar:c["a"],personalCreate:m["default"],companyDetail:d["default"]},props:{withModal:{type:Object,default:void 0}},data:function(){var e="edit"===this.withModal.type;return{show_create_person:!1,show_create_company:!1,company_edit_type:1,state_name:"",active:0,arr:[{stepTitle:"填写信息",stepDesc:e?"修改项目":"创建项目"},{stepTitle:e?"完成修改":"完成创建",stepDesc:e?"修改成功":"创建成功"}],permit_type_name:"",istop:!1,showIsTop:!1,canyuShow:!0,showSubmitBtn:!0,state:"",type:"",steps:"1",ruleForm:{projectType:"",projectTypeArray:[{value:"1",label:"技术服务（FW）"},{value:"2",label:"货物销售（XS）"},{value:"3",label:"建筑工程（GC）"},{value:"4",label:"建筑劳务（LW）"}],projectMode:2,projectModeArray:[{value:"1",label:"公开招标"},{value:"2",label:"直接签约"}],projectMoney:"",arr:[{name:"项目负责人",value:""}],projectName:"",projectNo:"",projectUnit:"",projectMan:"",bid_company_id:""},rules:{projectUnit:[{required:!0,message:"请输入招标单位",trigger:"blur"}],bid_company_id:[{required:!0,message:"请输入投标单位",trigger:"blur"}],projectMan:[{required:!0,message:"请输入项目项目负责人",trigger:"blur"}],projectType:[{required:!0,message:"请选择项目类型",trigger:"change"}],projectMoney:[{required:!0,message:"请输入项目金额",trigger:"blur"}],projectName:[{required:!0,message:"请输入项目名称",trigger:"blur"}],projectNo:[{required:!0,message:"请输入项目编号",trigger:"blur"}]},permit_response:void 0}},computed:{staffList:function(){return this.$store.state.company.staffList},companyList:function(){return this.$store.state.company.companyList}},mounted:function(){var e=this;return Object(l["a"])(Object(n["a"])().mark((function t(){var r,a,o,l,c,s,u,m,d,b,_,f,v,y,h,F,g;return Object(n["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.withModal){t.next=24;break}if(e.state_name=null===(r=e.withModal.permit_row)||void 0===r?void 0:r.state_name,e.permit_type_name=null===(a=e.withModal.permit_row)||void 0===a?void 0:a.permit_type_name,e.istop=null===(o=e.withModal.data)||void 0===o?void 0:o.istop,e.showIsTop=(null===(l=e.withModal.permit_row)||void 0===l?void 0:l.state)>=0,e.withModal.hide_permit_btn&&(e.canyuShow=!1),"audit"!==e.withModal.type){t.next=12;break}e.permitsGetInfoFun({id:null===(c=e.withModal.permit_row)||void 0===c?void 0:c.id}),e.showSubmitBtn=!1,e.type="audit",t.next=23;break;case 12:if(s=e.withModal,u=s.type,m=s.id,d=s.data,"edit"!==u&&"detail"!==u){t.next=23;break}return t.next=16,Object(p["e"])(m);case 16:b=t.sent,_=b.data[0],f={projectType:_.project_type+"",projectMode:2,projectMoney:_.project_money,projectMan:_.contacts_id,projectUnit:_.company_id,projectName:_.project_name,projectNo:_.project_code},e.ruleForm=Object(i["a"])(Object(i["a"])({},d),f),e.type=u,e.isTop=_.istop,e.showSubmitBtn="edit"===u;case 23:return t.abrupt("return");case 24:if(e.state_name=e.$route.query.state_name,e.permit_type_name=e.$route.query.permit_type_name,e.istop=1===e.$route.query.isTop,e.showIsTop=e.$route.query.state>=0,e.$route.query.canyuShow||void 0===e.$route.query.canyuShow||(e.canyuShow=e.$route.query.canyuShow),!e.$route.query.typeData){t.next=35;break}e.permitsGetInfoFun({id:e.$route.query.id}),e.showSubmitBtn=!1,e.type=!0,t.next=42;break;case 35:if(v=e.$route.query.type,y=JSON.parse(e.$route.query.data),"edit"!==v){t.next=42;break}return t.next=40,Object(p["e"])(y.id);case 40:h=t.sent,h.data&&h.data.length>0&&(F=h.data[0],g={projectType:F.project_type+"",projectMode:2,projectMoney:F.project_money,projectMan:F.contacts_id,projectUnit:F.company_id,projectName:F.project_name,projectNo:F.project_code},e.ruleForm=Object(i["a"])(Object(i["a"])({},y),g),e.type=v,e.isTop=F.istop);case 42:case"end":return t.stop()}}),t)})))()},methods:{handleAfterCreate:function(e){this.ruleForm.projectMan=e,this.show_create_person=!1},handleAfterCompanyCreate:function(e){1===this.company_edit_type?this.ruleForm.projectUnit=e:2===this.company_edit_type&&(this.ruleForm.bid_company_id=e),this.show_create_company=!1},openCreateCompany:function(e){this.company_edit_type=e,this.show_create_company=!0},handleTop:function(){var e=this;return Object(l["a"])(Object(n["a"])().mark((function t(){var r,a;return Object(n["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=e.withModal.data?p["k"]:u["a"],t.next=3,r({id:e.withModal?e.withModal.id:e.$route.query.id});case 3:a=t.sent,200===a.code&&(e.$message(a.msg),e.istop="取消置顶成功"!==a.msg);case 5:case"end":return t.stop()}}),t)})))()},handlePass:function(e){var t=this;return Object(l["a"])(Object(n["a"])().mark((function e(){var r;return Object(n["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(p["j"])({id:t.shenpi.id,type:"1"});case 2:r=e.sent,200===r.code&&(t.$message.success(r.msg),t.$emit("close"));case 4:case"end":return e.stop()}}),e)})))()},handleReject:function(e){var t=this;return Object(l["a"])(Object(n["a"])().mark((function e(){var r;return Object(n["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(p["j"])({id:t.shenpi.id,type:"2"});case 2:r=e.sent,200===r.code&&(t.$message.success(r.msg),t.$emit("close"));case 4:case"end":return e.stop()}}),e)})))()},createProjectName:function(){var e=this;if(this.ruleForm.projectType){var t=this.ruleForm.projectTypeArray.find((function(t){return t.value===e.ruleForm.projectType}));console.log("filterfilterfilterfilter",t),this.ruleForm.projectName=this.companyList.find((function(t){return t.id===e.ruleForm.projectUnit})).name+t.label.split("（")[0]+"项目"+this.ruleForm.projectNo+"(金额："+this.ruleForm.projectMoney+"元)"}},createProjectNo:function(){var e=this;this.$store.dispatch("project/getProjectNo",{project_type:this.ruleForm.projectType}).then((function(t){e.ruleForm.projectNo=t.data.project_code,console.log(e.ruleForm)}))},nextStep:function(e){var t=this;this.$refs[e].validate((function(e){if(!e)return console.log("error submit!!"),!1;var r={project_name:t.ruleForm.projectName,project_code:t.ruleForm.projectNo,project_money:t.ruleForm.projectMoney,project_type:t.ruleForm.projectType,create_name:"121",project_mode:2,contacts_id:t.ruleForm.projectMan,company_id:t.ruleForm.projectUnit,remarks:t.ruleForm.remarks,bid_company_id:t.ruleForm.bid_company_id};"edit"===t.withModal.type&&(r.id=t.withModal.id),Object(p["i"])(r,t.withModal.type).then((function(e){t.steps="2",t.$store.dispatch("company/updateAll","project"),t.active+=2,t.$emit("refreshList")}))}))},handleBack:function(){this.$emit("close")},Recreate:function(){this.$emit("refresh")},permitsGetInfoFun:function(){var e=this;return Object(l["a"])(Object(n["a"])().mark((function t(){var r,a;return Object(n["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(u["z"])({id:null===(r=e.withModal.permit_row)||void 0===r?void 0:r.id});case 2:a=t.sent,e.ruleForm.projectName=a.data.info.project_name,e.ruleForm.projectNo=a.data.info.project_code,e.ruleForm.projectMoney=a.data.info.project_money,e.ruleForm.projectType=a.data.info.project_type+"",e.ruleForm.projectMode=2,e.ruleForm.projectMan=a.data.info.contacts_id,e.ruleForm.projectUnit=a.data.info.company_id,e.ruleForm.bid_company_id=a.data.info.bid_company_id,e.shenpi=a.data,e.state=a.data.info.state,e.isTop=a.data.info.istop,a.data.project_id&&(e.permit_response=a.data);case 15:case"end":return t.stop()}}),t)})))()},toProjectDetail:function(){var e=this,t=e.permit_response.info;"未签约"===t.main_contract_id?Object(b["c"])(this,"NewProject",{data:JSON.stringify(t),type:"edit",isTop:t.istop}):Object(b["c"])(this,"projectDetail",{id:t.id,isTop:t.istop})}}},f=_,v=(r("75c8"),r("2877")),y=Object(v["a"])(f,a,o,!1,null,"0e8cb4e8",null);t["default"]=y.exports},e3d4:function(e,t,r){},e4af:function(e,t,r){},ed08:function(e,t,r){"use strict";r.d(t,"b",(function(){return n})),r.d(t,"a",(function(){return i})),r.d(t,"c",(function(){return l}));r("53ca"),r("d81d"),r("a434"),r("d3b7"),r("4d63"),r("ac1f"),r("2c3e"),r("00b4"),r("25f0"),r("4d90"),r("5319"),r("0643"),r("4e3e"),r("a573"),r("159b");var a=r("21a6"),o=r("25ca");r("bc3a"),r("aeb1");function n(e,t,r,n){var i=[],l=[],c=function(e){var t=0;for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t++;return t};for(var s in e)if(console.log("------------------------"),Object.prototype.hasOwnProperty.call(e,s)){var u=e[s],p=[];for(var m in u)if(Object.prototype.hasOwnProperty.call(u,m)){var d=u[m];p.push(d),l.length<c(u)&&l.push(m)}i.push(p)}var b=[];r.map((function(e,t){"快速操作"!=e&&"详情"!=e&&b.push(e)})),i.splice(0,0,l,b),console.log("excel_data",o);var _=o["utils"].aoa_to_sheet(i),f=o["utils"].book_new(),v=[{hidden:!0}];_["!rows"]=v,o["utils"].book_append_sheet(f,_,n);var y=o["write"](f,{bookType:"xlsx",type:"array"}),h=new Blob([y],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=UTF-8"});Object(a["saveAs"])(h,t+".xlsx")}function i(e){var t=-1!==e.lastIndexOf("?")?decodeURIComponent(e.substring(e.lastIndexOf("/")+1,e.lastIndexOf("?"))):decodeURIComponent(e.substring(e.lastIndexOf("/")+1)),r=t.substring(t.lastIndexOf(".")+1);if("png"==r||"jpg"==r||"pdf"==r){var o=document.createElement("a");o.href=e,o.download=t,o.target="_blank",o.click()}else fetch(e,{mode:"no-cors"}).then((function(e){return e.blob()})).then((function(e){console.log("blob",e),Object(a["saveAs"])(e,t)}))}function l(e,t,r){console.log("self",e);var a=e.$router.resolve({name:t,query:r}),o=window.open(a.href,t);o&&o.location.reload()}}}]);