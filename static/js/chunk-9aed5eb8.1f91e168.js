(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-9aed5eb8"],{"227d":function(e,t,n){},"50ac":function(e,t,n){"use strict";n("227d")},aaa6:function(e,t,n){"use strict";n("ad93")},ad93:function(e,t,n){},d626:function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"w-full h-full container"},[e.loading?n("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"w-full h-full"}):n("div",{staticClass:"w-full"},[n("el-tree",{attrs:{data:e.list,"node-key":"id","default-expand-all":"","expand-on-click-node":!1},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.node,r=t.data;return n("span",{class:"custom-tree-node "+(r.is_leaf?"is-leaf":"")},[n("span",[e._v(e._s(a.label))]),r.is_leaf?n("span",[n("el-switch",{attrs:{disabled:e.rowLoading.includes(r.id),value:r.process_switch,"active-value":1,"inactive-value":2},on:{change:function(t){return e.updateProcess(Object.assign({},r,{process_switch:t}))}}}),n("el-button",{attrs:{size:"mini",type:"text",loading:e.rowLoading.includes(r.id)},on:{click:function(t){return e.openEdit(r)}}},[e._v(" 审批流 ")])],1):e._e()])}}])}),n("el-drawer",{attrs:{visible:e.showDrawer,size:"85%","destroy-on-close":!0},on:{"update:visible":function(t){e.showDrawer=t},close:e.closeDrawer}},[e.cur?n("flow-map",{attrs:{target:e.cur,nodes:e.nodes},on:{close:e.closeDrawer}}):e._e()],1)],1)])},r=[],i=n("2909"),s=n("c7eb"),o=n("1da1"),c=n("5530"),l=(n("99af"),n("4de4"),n("7db0"),n("c740"),n("a434"),n("d3b7"),n("0643"),n("2382"),n("4e3e"),n("159b"),n("b775")),d=function(){return Object(l["a"])({url:"/Configs/getPermitProcessList",method:"post"})},u=function(e){return Object(l["a"])({url:"/Configs/updatePermitProcess",data:e,method:"post"})},f=function(){return Object(l["a"])({url:"/Configs/groupList",method:"post"})},p=n("5c96"),h=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"process-map"},[n("div",{staticClass:"w-full flex flex-row justify-between align-center"},[n("div",{staticClass:"w-full flex flex-row justify-start align-center name-container"},[n("span",{staticClass:"label"},[e._v("流程名称")]),n("div",{staticClass:"flex-1"},[n("el-input",{attrs:{placeholder:"请输入流程名称",required:"",label:"流程名称"},model:{value:e.process_name,callback:function(t){e.process_name=t},expression:"process_name"}})],1)]),n("el-button",{attrs:{type:"primary"},on:{click:e.openAdd}},[e._v("添加节点")])],1),n("div",{ref:"mapRef",staticClass:"w-full flex-1 map"}),n("div",{staticClass:"w-full flex flex-row justify-center align-center"},[n("el-button",{attrs:{type:"primary"},on:{click:e.onSubmit}},[e._v("提交")])],1),n("el-dialog",{attrs:{visible:e.showDialog,"append-to-body":""},on:{"update:visible":function(t){e.showDialog=t}}},[n("el-form",{attrs:{model:e.dialogForm,rules:e.rules}},[n("el-form-item",{attrs:{label:"选择节点",prop:"node"}},[n("el-select",{attrs:{placeholder:"请选择加入的节点"},model:{value:e.dialogForm.node,callback:function(t){e.$set(e.dialogForm,"node",t)},expression:"dialogForm.node"}},e._l(e.nodes,(function(t){return n("el-option",{key:t.id,attrs:{label:t.title,value:t.id,disabled:e.alreadyNode.includes(t.id)}})})),1)],1),n("el-form-item",[n("el-button",{attrs:{type:"primary",disabled:!e.dialogForm.node},on:{click:e.doAdd}},[e._v("确定")])],1)],1)],1)],1)},g=[],b=(n("d81d"),n("b0c0"),n("e9c4"),n("fffc"),n("a573"),n("fa53")),v=(n("c814"),n("2edc")),m=n("d4ec"),w=n("bee2"),j=n("8f33"),O=n("262e"),x=function(e){function t(){return Object(m["a"])(this,t),Object(j["a"])(this,t,arguments)}return Object(O["a"])(t,e),Object(w["a"])(t,[{key:"getShape",value:function(){var e=this.props,t=e.model,n=e.graphModel,a=t.x,r=t.y,i=t.width,s=t.height,o=t.getNodeStyle();return Object(b["e"])("g",{},[Object(b["e"])("rect",Object(c["a"])(Object(c["a"])({},o),{},{x:a-i/2,y:r-s/2,width:i,height:s,rx:5,ry:5})),Object(b["e"])("text",{x:a+i/2-28,y:r+14-s/2,fill:"#ff0000",fontSize:"14px",onClick:function(){n.eventCenter.emit("custom:node-delete",t.properties)}},["删除"])])}}])}(b["b"]),y=function(e){function t(){return Object(m["a"])(this,t),Object(j["a"])(this,t,arguments)}return Object(O["a"])(t,e),Object(w["a"])(t,[{key:"getConnectedSourceRules",value:function(){var e=this,n=Object(v["a"])(t,"getConnectedSourceRules",this,3)([]),a={message:"只能连接一个节点",validate:function(t){var n=t.id,a=e.graphModel.getNodeOutgoingNode(n);return 0===a.length}};return n.push(a),n}},{key:"getConnectedTargetRules",value:function(){var e=this,n=Object(v["a"])(t,"getConnectedTargetRules",this,3)([]),a={message:"只能被一个节点连接",validate:function(t,n){var a=n.id,r=e.graphModel.getNodeIncomingNode(a);return 0===r.length}};return n.push(a),n}}])}(b["c"]),_={view:x,model:y,type:"role-node"},k={stopScrollGraph:!0,stopMoveGraph:!0,stopZoomGraph:!0,adjustNodePosition:!0},N={name:"ProcessMap",props:{nodes:{type:Array,default:function(){return[]}},target:{type:Object,default:void 0}},data:function(){return{lf:null,process_name:"",nodeDatas:{nodes:[],edges:[]},alreadyNode:[],showDialog:!1,dialogForm:{node:void 0},rules:{node:[{required:!0,message:"请选择节点",trigger:"blur"}]},loading:!1}},mounted:function(){var e=this;if(this.target&&(this.process_name=this.target.process_name||""),this.$refs.mapRef){var t=this.$refs.mapRef.offsetHeight;this.target.process_value.forEach((function(n,a){e.alreadyNode.push(n.id),e.nodeDatas.nodes.push({id:n.id,type:"role-node",x:120+240*a,y:Math.floor(t/3),text:{x:120+240*a,y:Math.floor(t/3),value:n.name},properties:{_roleDatas:n,width:180,height:80}}),a>0&&e.nodeDatas.edges.push({type:"polyline",targetNodeId:n.id,sourceNodeId:e.target.process_value[a-1].id})})),this.lf=new b["d"](Object(c["a"])({container:this.$refs.mapRef,grid:!0,height:t},k)),this.lf.register(_),this.lf.on("custom:node-delete",(function(t){var n=t._roleDatas.id;e.lf.deleteNode(n),e.alreadyNode=e.alreadyNode.filter((function(e){return e!==n}))})),this.lf.on("connection:not-allowed",(function(e){var t=e.msg;p["Notification"].error({title:"线性流程提示",message:t})})),this.lf.render(this.nodeDatas)}},methods:{openAdd:function(){this.showDialog=!0},doAdd:function(){var e=this,t=this.nodes.find((function(t){return t.id===e.dialogForm.node}));t&&(this.alreadyNode.push(t.id),this.lf.addNode({id:t.id,type:"role-node",x:460,y:200,text:{x:460,y:200,value:t.title},properties:{_roleDatas:{id:t.id,name:t.title},width:180,height:80}}),this.showDialog=!1)},onSubmit:function(){var e=this;return Object(o["a"])(Object(s["a"])().mark((function t(){var n,a,r,o,c,l,d,f,h,g;return Object(s["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.process_name){t.next=3;break}return p["Message"].error("流程名称不能为空"),t.abrupt("return");case 3:if(n=e.lf.getGraphRawData(),a=Object(i["a"])(n.edges),r=Object(i["a"])(n.nodes),a.length===r.length-1){t.next=9;break}return p["Notification"].error({title:"提示",message:"请串联所有节点"}),t.abrupt("return");case 9:if(o=[],r.length<=1)1===r.length&&o.push(r[0].properties._roleDatas);else{c=null,a.forEach((function(e,t,n){var a=n.find((function(t){return t.targetNodeId===e.sourceNodeId}));a||(c=e)})),l=[c];while(l.length<a.length)d=a.find((function(e){return e.sourceNodeId===l[l.length-1].targetNodeId})),d&&l.push(d);f=[l[0].sourceNodeId].concat(Object(i["a"])(l.map((function(e){return e.targetNodeId})))),f.forEach((function(e){var t=r.find((function(t){return t.id===e})).properties._roleDatas;o.push(t)}))}return h={id:e.target.id,process_name:e.process_name,process_value:JSON.stringify(o),process_switch:e.target.process_switch},t.prev=12,e.loading=!0,t.next=16,u(h);case 16:g=t.sent,200===g.code?(p["Message"].success(g.msg||"操作成功"),e.$emit("close")):p["Message"].error(g.msg||"操作失败"),t.next=24;break;case 20:t.prev=20,t.t0=t["catch"](12),console.error(t.t0),p["Notification"].error(t.t0.message||t.t0.msg||"系统异常");case 24:return t.prev=24,e.loading=!1,t.finish(24);case 27:case"end":return t.stop()}}),t,null,[[12,20,24,27]])})))()}}},D=N,C=(n("aaa6"),n("2877")),L=Object(C["a"])(D,h,g,!1,null,"388497c9",null),M=L.exports,R=function(e){var t=[];return e.forEach((function(e){var n=t.find((function(t){return t.id===e.pid}));if(n)n.children.push(Object(c["a"])(Object(c["a"])({},e),{},{label:"名称：".concat(e.process_name," （").concat(e.title,"）"),is_leaf:!0}));else{var a=e.title.split("->")[1];t.push({id:e.pid,label:a||"",children:[Object(c["a"])(Object(c["a"])({},e),{},{label:"名称：".concat(e.process_name," （").concat(e.title,"）"),is_leaf:!0})]})}})),t},I={name:"PermitProcess",components:{flowMap:M},data:function(){return{loading:!1,rowLoading:[],originList:[],list:[],nodes:[],showDrawer:!1,cur:void 0}},mounted:function(){this.initRequest()},methods:{initRequest:function(){var e=this;return Object(o["a"])(Object(s["a"])().mark((function t(){var n;return Object(s["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,e.loading=!0,t.next=4,e.getList();case 4:return t.next=6,f();case 6:n=t.sent,e.nodes=n.data,t.next=13;break;case 10:t.prev=10,t.t0=t["catch"](0),console.error("[获取审批流程失败]",t.t0);case 13:return t.prev=13,e.loading=!1,t.finish(13);case 16:case"end":return t.stop()}}),t,null,[[0,10,13,16]])})))()},getList:function(){var e=this;return Object(o["a"])(Object(s["a"])().mark((function t(){var n;return Object(s["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,d();case 2:n=t.sent,e.originList=Object(i["a"])(n.data),e.list=R(n.data);case 5:case"end":return t.stop()}}),t)})))()},updateProcess:function(e){var t=this;return Object(o["a"])(Object(s["a"])().mark((function n(){var a,r;return Object(s["a"])().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(e){n.next=2;break}return n.abrupt("return");case 2:return n.prev=2,t.rowLoading.push(e.id),n.next=6,u(e);case 6:a=n.sent,200===a.code&&(p["Message"].success(a.msg),r=t.originList.findIndex((function(t){return t.id===e.id})),-1!==r&&(t.originList.splice(r,1,e),t.list=R(t.originList))),n.next=13;break;case 10:n.prev=10,n.t0=n["catch"](2),console.error("[更新审批流程失败]",n.t0);case 13:return n.prev=13,t.rowLoading=t.rowLoading.filter((function(t){return t!==e.id})),n.finish(13);case 16:case"end":return n.stop()}}),n,null,[[2,10,13,16]])})))()},openEdit:function(e){this.cur=e,this.showDrawer=!0},closeDrawer:function(){var e=this;return Object(o["a"])(Object(s["a"])().mark((function t(){return Object(s["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.cur=void 0,e.showDrawer=!1,e.loading=!0,t.next=5,e.getList();case 5:e.loading=!1;case 6:case"end":return t.stop()}}),t)})))()}}},P=I,S=(n("50ac"),Object(C["a"])(P,a,r,!1,null,"782fd1b6",null));t["default"]=S.exports}}]);