(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5d235037"],{1423:function(e,t,a){},1825:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"newApproval"},[e._e(),a("div",{staticStyle:{width:"650px",margin:"0 auto"}},[0==e.active?a("el-form",{ref:"ruleForm",staticClass:"newApprovalForm",attrs:{model:e.ruleForm,rules:e.rules,"label-width":"150px",size:"medium"}},[e.step?e._e():a("el-form-item",{attrs:{label:"项目名称",prop:"project_id"}},[a("el-select",{attrs:{disabled:e.disableFlag,placeholder:"请选择",filterable:"",clearable:""},on:{change:e.handleProjectChange},model:{value:e.ruleForm.project_id,callback:function(t){e.$set(e.ruleForm,"project_id",t)},expression:"ruleForm.project_id"}},e._l(e.projectList,(function(e){return a("el-option",{key:e.id,attrs:{label:e.project_name,value:e.id}})})),1)],1),e.step?e._e():a("el-form-item",{attrs:{label:"项目负责人",prop:"contacts_name"}},[a("el-select",{attrs:{disabled:!0,placeholder:"请选择",filterable:"",clearable:""},model:{value:e.ruleForm.contacts_name,callback:function(t){e.$set(e.ruleForm,"contacts_name",t)},expression:"ruleForm.contacts_name"}},e._l(e.projectList,(function(e){return a("el-option",{key:e.id,attrs:{label:e.contacts_name,value:e.id}})})),1)],1),e.step?e._e():a("el-form-item",{attrs:{label:"招标公司",prop:"company_id"}},[a("el-select",{attrs:{disabled:!0,placeholder:"请选择",filterable:"",clearable:""},model:{value:e.ruleForm.company_id,callback:function(t){e.$set(e.ruleForm,"company_id",t)},expression:"ruleForm.company_id"}},e._l(e.companyList,(function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),e.step?e._e():a("el-form-item",{attrs:{label:"投标公司",prop:"bid_company_id"}},[a("el-select",{attrs:{disabled:!0,placeholder:"请选择",filterable:"",clearable:""},model:{value:e.ruleForm.bid_company_id,callback:function(t){e.$set(e.ruleForm,"bid_company_id",t)},expression:"ruleForm.bid_company_id"}},e._l(e.companyList,(function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),a("el-form-item",{attrs:{label:"付款方式",prop:"pay_type"}},[a("el-select",{attrs:{disabled:e.disableFlag,placeholder:"请选择",filterable:"",clearable:""},model:{value:e.ruleForm.pay_type,callback:function(t){e.$set(e.ruleForm,"pay_type",t)},expression:"ruleForm.pay_type"}},e._l(e.payTypeList,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),a("el-form-item",{attrs:{label:"付款账户类型",prop:"payment_type"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择付款账户类型",disabled:e.detailToCreate},model:{value:e.ruleForm.payment_type,callback:function(t){e.$set(e.ruleForm,"payment_type",t)},expression:"ruleForm.payment_type"}},[a("el-option",{attrs:{label:"公司",value:1}}),a("el-option",{attrs:{label:"个人",value:2}})],1)],1),1==e.ruleForm.payment_type?[a("el-form-item",{attrs:{label:"付款方",prop:"payment_company_id"}},[a("el-select",{attrs:{disabled:e.disableFlag,placeholder:"请选择",filterable:"",clearable:""},model:{value:e.ruleForm.payment_company_id,callback:function(t){e.$set(e.ruleForm,"payment_company_id",t)},expression:"ruleForm.payment_company_id"}},e._l(e.companyList,(function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),1==e.ruleForm.pay_type||4==e.ruleForm.pay_type?a("el-form-item",{attrs:{label:"付款账号",prop:"payment_company_bank_id"}},[a("el-select",{attrs:{disabled:!e.ruleForm.payment_company_id||e.disableFlag,placeholder:"请选择",filterable:"",clearable:""},model:{value:e.ruleForm.payment_company_bank_id,callback:function(t){e.$set(e.ruleForm,"payment_company_bank_id",t)},expression:"ruleForm.payment_company_bank_id"}},e._l(e.companyListAccount,(function(e){return a("el-option",{key:e.id,attrs:{label:e.open_bank+":"+e.bank_number,value:e.id}})})),1)],1):e._e()]:e._e(),2==e.ruleForm.payment_type?[a("el-form-item",{attrs:{label:"个人付款id",prop:"payment_staff_id"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择",clearable:"",filterable:""},model:{value:e.ruleForm.payment_staff_id,callback:function(t){e.$set(e.ruleForm,"payment_staff_id",t)},expression:"ruleForm.payment_staff_id"}},e._l(e.staffList,(function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),1==e.ruleForm.pay_type||4==e.ruleForm.pay_type?a("el-form-item",{attrs:{label:"个人付款账户",prop:"payment_staff_bank_id"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择",clearable:"",filterable:""},model:{value:e.ruleForm.payment_staff_bank_id,callback:function(t){e.$set(e.ruleForm,"payment_staff_bank_id",t)},expression:"ruleForm.payment_staff_bank_id"}},e._l(e.payment_staff_bank_idArr,(function(e){return a("el-option",{key:e.id,attrs:{label:e.open_bank+":"+e.bank_number,value:e.id}})})),1)],1):e._e()]:e._e(),a("el-form-item",{attrs:{label:"收款账户类型",prop:"revenue_type"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择收款账户类型",disabled:e.detailToCreate},model:{value:e.ruleForm.revenue_type,callback:function(t){e.$set(e.ruleForm,"revenue_type",t)},expression:"ruleForm.revenue_type"}},[a("el-option",{attrs:{label:"公司",value:1}}),a("el-option",{attrs:{label:"个人",value:2}})],1)],1),1==e.ruleForm.revenue_type?[a("el-form-item",{attrs:{label:"收款方",prop:"revenue_company_id"}},[a("el-select",{attrs:{disabled:e.disableFlag,placeholder:"请选择",filterable:"",clearable:""},model:{value:e.ruleForm.revenue_company_id,callback:function(t){e.$set(e.ruleForm,"revenue_company_id",t)},expression:"ruleForm.revenue_company_id"}},e._l(e.companyList,(function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),1==e.ruleForm.pay_type||4==e.ruleForm.pay_type?a("el-form-item",{attrs:{label:"收款账户",prop:"revenue_company_bank_id"}},[a("el-select",{attrs:{disabled:!e.ruleForm.revenue_company_id||e.disableFlag,placeholder:"请选择",filterable:"",clearable:""},model:{value:e.ruleForm.revenue_company_bank_id,callback:function(t){e.$set(e.ruleForm,"revenue_company_bank_id",t)},expression:"ruleForm.revenue_company_bank_id"}},e._l(e.companyListAccountRevenue,(function(e){return a("el-option",{key:e.id,attrs:{label:e.open_bank+":"+e.bank_number,value:e.id}})})),1)],1):e._e()]:e._e(),2==e.ruleForm.revenue_type?[a("el-form-item",{attrs:{label:"个人收款id",prop:"revenue_staff_id"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择",clearable:"",filterable:""},model:{value:e.ruleForm.revenue_staff_id,callback:function(t){e.$set(e.ruleForm,"revenue_staff_id",t)},expression:"ruleForm.revenue_staff_id"}},e._l(e.staffList,(function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),1==e.ruleForm.pay_type||4==e.ruleForm.pay_type?a("el-form-item",{attrs:{label:"个人收款账户",prop:"revenue_staff_bank_id"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择",filterable:"",clearable:""},model:{value:e.ruleForm.revenue_staff_bank_id,callback:function(t){e.$set(e.ruleForm,"revenue_staff_bank_id",t)},expression:"ruleForm.revenue_staff_bank_id"}},e._l(e.revenue_staff_idArr,(function(e){return a("el-option",{key:e.id,attrs:{label:e.open_bank+":"+e.bank_number,value:e.id}})})),1)],1):e._e()]:e._e(),a("el-form-item",{attrs:{label:"付款金额",prop:"payment_money"}},[a("el-input",{staticClass:"moneyStyle",attrs:{title:e.ruleForm.payment_money,disabled:e.disableFlag,placeholder:"请输入"},model:{value:e.ruleForm.payment_money,callback:function(t){e.$set(e.ruleForm,"payment_money",t)},expression:"ruleForm.payment_money"}})],1),a("el-form-item",{attrs:{label:"备注"}},[a("el-input",{attrs:{title:e.ruleForm.remarks,placeholder:"请输入",disabled:e.disableFlag},model:{value:e.ruleForm.remarks,callback:function(t){e.$set(e.ruleForm,"remarks",t)},expression:"ruleForm.remarks"}})],1),2==e.active?a("el-form-item",{attrs:{label:"备注信息",prop:"remarks"}},[a("el-input",{attrs:{title:e.ruleForm.remarks,disabled:e.disableFlag,type:"textarea"},model:{value:e.ruleForm.remarks,callback:function(t){e.$set(e.ruleForm,"remarks",t)},expression:"ruleForm.remarks"}})],1):e._e(),a("el-form-item",{attrs:{label:"相关附件",prop:"receipt"}},[a("el-upload",{staticClass:"upload-demo",attrs:{action:"##","file-list":e.fileList,"before-upload":e.beforUpload,"on-remove":e.handleRemove,"before-remove":e.beforeRemove,"on-preview":e.handleDown}},[a("el-button",{attrs:{size:"small",type:"primary"}},[e._v("点击上传")])],1)],1),a("el-form-item",[a("el-button",{staticStyle:{"margin-top":"12px"},attrs:{type:"primary"},on:{click:function(t){return e.submitForm("ruleForm")}}},[e._v("提交")])],1)],2):e._e()],1)])},n=[],i=a("c7eb"),l=a("1da1"),o=a("5530"),s=a("ade3"),p=(a("7db0"),a("caad"),a("d81d"),a("b0c0"),a("e9c4"),a("a9e3"),a("b64b"),a("d3b7"),a("0643"),a("fffc"),a("4e3e"),a("a573"),a("159b"),a("fef7")),m=a("277f"),c=a("9437"),u=a("2f62"),d={components:{ProgressBar:p["a"]},props:{withModal:{type:Object,default:void 0}},data:function(){var e=this;return{detailToCreate:!1,disableFlag:!1,step:!1,loding:!1,id:"",fileList:[],barWidth:"",active:0,payTypeList:[{label:"网银转账",value:1},{label:"现钞",value:2},{label:"担保手续",value:3},{label:"网银转账+担保手续",value:4},{label:"现钞+借据",value:5},{label:"投标保证金保函/保险",value:6}],arr:[{stepTitle:"客户垫付",stepDesc:""},{stepTitle:"支付投标人",stepDesc:""},{stepTitle:"支付招标方",stepDesc:""},{stepTitle:"退还投标人",stepDesc:""},{stepTitle:"退还集团",stepDesc:""},{stepTitle:"退还客户",stepDesc:"必须退回客户原账户"}],ruleForm:{project_id:"",payment_company_id:"",payment_company_bank_id:"",revenue_company_id:"",revenue_company_bank_id:"",payment_money:"",pay_type:"",remarks:"",payment_type:1,payment_staff_id:"",payment_staff_bank_id:"",revenue_type:1,revenue_staff_id:"",revenue_staff_bank_id:"",client_company_id:"",bid_company_id:"",contacts_name:"",company_id:""},rules:Object(s["a"])(Object(s["a"])(Object(s["a"])(Object(s["a"])({project_id:[{required:!0,message:"请选择项目名称",trigger:"change"}],payment_company_id:[{required:!0,message:"请选择付款方",trigger:"change"}],payment_company_bank_id:[{required:!0,message:"请选择付款账号",trigger:"change"}],payment_staff_id:[{required:!0,message:"请选择个人付款id",trigger:"change"}],payment_staff_bank_id:[{required:!0,message:"请选择个人付款账户",trigger:"change"}],revenue_company_id:[{required:!0,message:"请选择收款方",trigger:"change"}],revenue_company_bank_id:[{required:!0,message:"请选择收款账户",trigger:"change"}],revenue_staff_id:[{required:!0,message:"请选择个人收款id",trigger:"change"}],revenue_staff_bank_id:[{required:!0,message:"请选择个人收款账户",trigger:"change"}],payment_money:[{required:!0,message:"请输入金额",trigger:"blur"}],pay_type:[{required:!0,message:"请选择付款方式",trigger:"change"}],remarks:[{required:!0,message:"请输入备注信息",trigger:"blur"}],receipt:[{required:!0,validator:function(t,a,r){0==e.fileList.length?r(new Error("请上传银行回执/借据")):r()}}],client_company_id:[{required:!0,message:"请选择客户公司",trigger:"blur"}]},"payment_staff_id",[{required:!0,message:"请选择付款方",trigger:"blur"}]),"payment_staff_bank_id",[{required:!0,message:"请选择付款方账号",trigger:"blur"}]),"revenue_staff_id",[{required:!0,message:"请选择收款方",trigger:"blur"}]),"revenue_staff_bank_id",[{required:!0,message:"请选择收款账号",trigger:"blur"}]),companyList:[],projectList:[],companyListAccount:[],companyListAccountRevenue:[],payment_staff_bank_idArr:[],revenue_staff_idArr:[]}},computed:{staffList:function(){return this.$store.state.company.staffList}},watch:{"ruleForm.payment_company_id":{handler:function(e,t){var a=this;e!=t&&t&&(this.ruleForm.payment_company_bank_id=""),e?this.$store.state.company.companyList.forEach((function(t){t.id==e&&(a.companyListAccount=t.companyBankList)})):(this.ruleForm.payment_company_bank_id="",this.companyListAccount=[])},deep:!0},"ruleForm.revenue_company_id":{handler:function(e,t){var a=this;e!=t&&t&&(this.ruleForm.revenue_company_bank_id=""),e?this.$store.state.company.companyList.forEach((function(t){t.id==e&&(a.companyListAccountRevenue=t.companyBankList)})):(this.ruleForm.revenue_company_bank_id="",this.companyListAccountRevenue=[])},deep:!0},"ruleForm.payment_staff_id":{handler:function(e,t){var a=this;e!=t&&t&&(this.ruleForm.payment_staff_bank_id=""),e&&this.$store.state.company.staffList.map((function(t){t.id==e&&(a.payment_staff_bank_idArr=t.staffBankList)}))},deep:!0},"ruleForm.revenue_staff_id":{handler:function(e,t){var a=this;e!=t&&t&&(this.ruleForm.revenue_staff_bank_id=""),e&&this.$store.state.company.staffList.map((function(t){t.id==e&&(a.revenue_staff_idArr=t.staffBankList)}))},deep:!0},fileList:{handler:function(e,t){e.length>0&&this.$refs.ruleForm.validateField("receipt")},deep:!0}},mounted:function(){var e,t,a,r=this;if(this.companyList=this.$store.state.company.companyList,this.projectList=this.$store.state.company.projectList,this.withModal){if(this.withModal.type){var n=this.withModal.type;switch(n){case"create":break;case"edit":if(this.id=this.withModal.id,this.step=this.withModal.step,this.withModal.data){var i,l=this.withModal.data;this.fileList=l.file?JSON.parse(l.file).map((function(e){return{url:e,name:r.getFileName(e)}})):[],this.$store.state.company.companyList.map((function(e){e.id===l.payment_company_id&&(r.companyListAccount=e.companyBankList),e.id===l.revenue_company_id&&(r.companyListAccountRevenue=e.companyBankList)})),this.ruleForm={bid_company_id:l.client_company_id,payment_type:l.payment_type,revenue_type:l.revenue_type,project_id:this.$route.params.id||(null===(i=this.withModal)||void 0===i?void 0:i.id),payment_company_id:l.payment_company_id,payment_company_bank_id:l.payment_company_bank_id?Number(l.payment_company_bank_id):"",revenue_company_id:l.payment_company_bank_id?Number(l.revenue_company_id):"",revenue_company_bank_id:l.revenue_company_bank_id?Number(l.revenue_company_bank_id):"",payment_money:l.payment_money,pay_type:l.pay_type?Number(l.pay_type):"",remarks:l.remarks,file:l.file,payment_staff_id:l.payment_staff_id,payment_staff_bank_id:l.payment_staff_bank_id,revenue_staff_id:l.revenue_staff_id,revenue_staff_bank_id:l.revenue_staff_bank_id},this.$forceUpdate()}break;default:break}}}else{var o,s;if(this.$route.params.id||null!==(e=this.withModal)&&void 0!==e&&e.id)this.id=this.$route.params.id||(null===(o=this.withModal)||void 0===o?void 0:o.id);if(this.$route.params.step||null!==(t=this.withModal)&&void 0!==t&&t.step)this.step=this.$route.params.step||(null===(s=this.withModal)||void 0===s?void 0:s.step),console.log(" this.step",this.step);if(console.log("this.$route.params.data",this.$route.params.data),this.$route.params.data||null!==(a=this.withModal)&&void 0!==a&&a.data){var p,m,c=this.$route.params.data||(null===(p=this.withModal)||void 0===p?void 0:p.data);this.fileList=c.file?JSON.parse(c.file).map((function(e){return{url:e,name:r.getFileName(e)}})):[],this.$store.state.company.companyList.map((function(e){e.id==c.payment_company_id&&(r.companyListAccount=e.companyBankList),e.id==c.revenue_company_id&&(r.companyListAccountRevenue=e.companyBankList)})),this.ruleForm={bid_company_id:c.client_company_id,payment_type:c.payment_type,revenue_type:c.revenue_type,project_id:this.$route.params.id||(null===(m=this.withModal)||void 0===m?void 0:m.id),payment_company_id:c.payment_company_id,payment_company_bank_id:c.payment_company_bank_id?Number(c.payment_company_bank_id):"",revenue_company_id:c.payment_company_bank_id?Number(c.revenue_company_id):"",revenue_company_bank_id:c.revenue_company_bank_id?Number(c.revenue_company_bank_id):"",payment_money:c.payment_money,pay_type:c.pay_type?Number(c.pay_type):"",remarks:c.remarks,file:c.file,payment_staff_id:c.payment_staff_id,payment_staff_bank_id:c.payment_staff_bank_id,revenue_staff_id:c.revenue_staff_id,revenue_staff_bank_id:c.revenue_staff_bank_id},this.$forceUpdate(),console.log("this.ruleFormthis.ruleFormthis.ruleFormthis.ruleForm",this.ruleForm)}}},methods:Object(o["a"])(Object(o["a"])({},Object(u["c"])("app",["OPEN_PREVIEW"])),{},{handleDown:function(e){var t,a=e.name.split(".").pop();["pdf"].includes(a)&&(t="pdf"),["doc","docx"].includes(a)&&(t="doc"),["png","jpg","jpeg","gif","bmp"].includes(a)&&(t="pic"),this.OPEN_PREVIEW({url:e.url,type:t})},beforUpload:function(e){var t=this,a=new FormData;return a.append("files",e),Object(c["a"])(a).then((function(a){200==a.code&&(e.url=a.data.file,t.fileList.push(e))})),!1},handleRemove:function(e,t){this.fileList=t},beforeRemove:function(){},getFileName:function(e){return-1!==e.lastIndexOf("?")?decodeURIComponent(e.substring(e.lastIndexOf("/")+1,e.lastIndexOf("?"))):decodeURIComponent(e.substring(e.lastIndexOf("/")+1))},submitForm:function(e){var t=this,a=this;this.$refs[e].validate(function(){var e=Object(l["a"])(Object(i["a"])().mark((function e(r){var n,l,o,s,p;return Object(i["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!r){e.next=18;break}if(t.ruleForm.file=JSON.stringify(t.fileList.map((function(e){return e.url}))),console.log("step,data",a.$route.params.step,a.$route.params.data),!(a.$route.params.step||null!==(n=a.withModal)&&void 0!==n&&n.step||a.$route.params.data||null!==(l=a.withModal)&&void 0!==l&&l.data)){e.next=11;break}return o=Object.assign(t.ruleForm,{phase:t.step,id:t.id}),e.next=7,Object(m["e"])(o);case 7:s=e.sent,200==s.code&&(t.$emit("refreshList"),t.$emit("close")),e.next=15;break;case 11:return e.next=13,Object(m["c"])(t.ruleForm);case 13:p=e.sent,200==p.code&&(t.$emit("refreshList"),t.$emit("close"));case 15:t.next(),e.next=20;break;case 18:return console.log("error submit!!"),e.abrupt("return",!1);case 20:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},next:function(){this.active++>1&&(this.active=0),this.active++>1&&(this.active=0)},handleProjectChange:function(e){this.ruleForm.contacts_name=e;var t=this.projectList.find((function(t){return t.id==e}));this.ruleForm.company_id=t.company_id,this.ruleForm.bid_company_id=t.bid_company_id}})},_=d,y=(a("7cce"),a("2877")),f=Object(y["a"])(_,r,n,!1,null,"11bbc06d",null);t["default"]=f.exports},"7cce":function(e,t,a){"use strict";a("1423")},9437:function(e,t,a){"use strict";a.d(t,"a",(function(){return n}));var r=a("b775");function n(e){return Object(r["a"])({url:"Publics/upload",method:"post",data:e,headers:{"content-type":"multipart/form-data"}})}}}]);